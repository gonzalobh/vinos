
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Sommelier de Vins Fran√ßais ¬∑ Tomos.bot</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
    :root {
      --font-display: 'Playfair Display', serif;
      --font-body: 'Inter', 'Neue Haas Grotesk', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      --color-night: #0b0b0d;
      --color-obsidian: #131316;
      --color-carbon: #1b1b1f;
      --color-graphite: #222225;
      --color-porcelain: #f6f4ee;
      --color-ivory: #f8f8f6;
      --color-ink: #101010;
      --color-muted: #b7b7c2;
      --color-muted-dark: #8f8f9a;
      --color-accent: #C5A34F;
      --color-accent-soft: #D8BB6C;
      --shadow-veil: 0 48px 90px rgba(0, 0, 0, 0.55);
      --shadow-panel: 0 28px 60px rgba(0, 0, 0, 0.45);
      --shadow-hover: 0 26px 70px rgba(0, 0, 0, 0.55);
      --radius-xl: 32px;
      --radius-lg: 28px;
      --radius-md: 22px;
      --transition-base: all 0.45s ease;
      --transition-soft: cubic-bezier(0.4, 0, 0.2, 1);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    html, body {
      height: 100%;
      min-height: 100vh;
      min-height: -webkit-fill-available;
      overflow: hidden;
    }

    body {
      min-height: 100vh;
      min-height: -webkit-fill-available;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 18px;
      background:
        radial-gradient(circle at 18% 12%, rgba(197, 163, 79, 0.14), transparent 52%),
        radial-gradient(circle at 80% 0%, rgba(88, 86, 76, 0.18), transparent 60%),
        linear-gradient(160deg, var(--color-night), var(--color-obsidian) 55%, #070708 100%);
      color: var(--color-ivory);
      font-family: var(--font-body);
      letter-spacing: 0.01em;
      line-height: 1.6;
      position: relative;
      overflow: hidden;
      transition: background 0.8s ease, color 0.6s ease;
    }

    body::before {
      content: '';
      position: absolute;
      inset: 0;
      background:
        radial-gradient(circle at 25% 30%, rgba(216, 187, 108, 0.08), transparent 55%),
        radial-gradient(circle at 80% 65%, rgba(110, 110, 110, 0.08), transparent 60%);
      pointer-events: none;
      mix-blend-mode: screen;
      opacity: 0.9;
      transition: opacity 0.8s ease;
    }

    body[data-theme="light"] {
      background:
        radial-gradient(circle at 18% 12%, rgba(216, 187, 108, 0.28), transparent 58%),
        linear-gradient(160deg, #f4f3ed, #ebe8df 60%, #f8f6f1 100%);
      color: var(--color-ink);
    }

    body[data-theme="light"]::before {
      opacity: 0.55;
      background:
        radial-gradient(circle at 30% 25%, rgba(197, 163, 79, 0.22), transparent 50%),
        radial-gradient(circle at 80% 70%, rgba(255, 255, 255, 0.4), transparent 65%);
      mix-blend-mode: normal;
    }

    h1, h2, h3 {
      font-family: var(--font-display);
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    p {
      line-height: 1.8;
    }

    .chat-container {
      position: relative;
      width: 100%;
      max-width: 520px;
      height: 100vh;
      min-height: -webkit-fill-available;
      background: rgba(19, 19, 22, 0.9);
      border-radius: 0;
      box-shadow: none;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.04);
      backdrop-filter: blur(26px);
      transition: transform 0.6s var(--transition-soft), background 0.8s ease, border-color 0.6s ease;
    }

    @media (max-width: 767px) {
      body {
        padding: env(safe-area-inset-top, 0px) env(safe-area-inset-right, 0px) env(safe-area-inset-bottom, 0px) env(safe-area-inset-left, 0px);
        display: block;
      }

      .chat-container {
        border-radius: 0;
        height: calc(100vh - env(safe-area-inset-top, 0px) - env(safe-area-inset-bottom, 0px));
        max-height: none;
        margin: 0 auto;
      }

      .options-container.initial-options {
        flex-wrap: nowrap;
        overflow-x: auto;
        padding-bottom: 6px;
        padding-right: 12px;
        -webkit-overflow-scrolling: touch;
        scroll-snap-type: x proximity;
      }

      .options-container.initial-options .option-button {
        flex: 0 0 auto;
        scroll-snap-align: start;
      }

      .options-container.initial-options .option-button.toggle-button {
        position: sticky;
        right: 0;
      }
    }

    @supports (height: 100dvh) {
      html, body {
        min-height: 100dvh;
      }

      .chat-container {
        min-height: 100dvh;
        height: 100dvh;
      }

      @media (max-width: 767px) {
        .chat-container {
          height: calc(100dvh - env(safe-area-inset-top, 0px) - env(safe-area-inset-bottom, 0px));
        }
      }
    }

    @media (min-width: 768px) {
      body {
        padding: 28px;
      }

      .chat-container {
        height: 88vh;
        max-height: 880px;
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-veil);
      }
    }

    body[data-theme="light"] .chat-container {
      background: rgba(250, 248, 242, 0.82);
      border: 1px solid rgba(16, 16, 16, 0.05);
      box-shadow: 0 40px 80px rgba(0, 0, 0, 0.12);
      backdrop-filter: blur(20px);
    }

    .header {
      position: relative;
      padding: 26px 32px 22px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 18px;
      flex-shrink: 0;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 6px;
      position: relative;
      z-index: 1;
    }

    @media (max-width: 480px) {
      .header {
        padding: 18px 18px 16px;
        gap: 12px;
      }

      .header-content {
        gap: 12px;
        min-width: 0;
      }

      .header-icon {
        width: clamp(40px, 12vw, 48px);
        height: clamp(40px, 12vw, 48px);
        border-radius: clamp(16px, 6vw, 22px);
      }

      .header-titles {
        gap: clamp(4px, 1.2vw, 8px);
      }

      .header-title {
        font-size: clamp(16px, 4.8vw, 18px);
        letter-spacing: clamp(0.08em, 0.3vw, 0.12em);
      }

      .header-actions {
        gap: 4px;
      }

      .icon-button {
        width: 32px;
        height: 32px;
      }

      .language-select select {
        padding: 6px 22px 6px 10px;
        font-size: 10px;
        letter-spacing: 0.05em;
      }

      .language-select::after {
        right: 9px;
        font-size: 10px;
      }
    }

    .header::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(197, 163, 79, 0.16), rgba(255, 255, 255, 0.02));
      opacity: 0.55;
      pointer-events: none;
    }

    .header-content {
      display: flex;
      align-items: center;
      gap: 18px;
      position: relative;
      z-index: 1;
    }

    .header-icon {
      width: clamp(44px, 6vw, 60px);
      height: clamp(44px, 6vw, 60px);
      border-radius: clamp(18px, 2vw, 26px);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background:
        radial-gradient(circle at 30% 30%, rgba(216, 187, 108, 0.65), rgba(197, 163, 79, 0.25)),
        linear-gradient(160deg, rgba(255, 255, 255, 0.12), rgba(12, 12, 12, 0.6));
      color: var(--color-accent-soft);
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.25), 0 12px 26px rgba(0, 0, 0, 0.45);
      position: relative;
      overflow: hidden;
    }

    .header-icon::after {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: inherit;
      background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.25), transparent 55%);
      opacity: 0.45;
      pointer-events: none;
    }

    body[data-theme="light"] .header-icon {
      background:
        radial-gradient(circle at 40% 30%, rgba(197, 163, 79, 0.4), rgba(216, 187, 108, 0.18)),
        linear-gradient(160deg, rgba(255, 255, 255, 0.75), rgba(255, 255, 255, 0.35));
      color: #745a1a;
      box-shadow: inset 0 0 0 1px rgba(197, 163, 79, 0.4), 0 12px 24px rgba(0, 0, 0, 0.1);
    }

    .header-titles {
      display: flex;
      align-items: center;
      gap: clamp(6px, 1.4vw, 12px);
    }

    .header-title {
      display: inline-flex;
      align-items: center;
      gap: clamp(6px, 1.4vw, 12px);
      font-size: clamp(18px, 2.4vw, 24px);
      letter-spacing: clamp(0.12em, 0.35vw, 0.22em);
      text-transform: uppercase;
      white-space: nowrap;
    }

    .header-flag {
      display: inline-flex;
      align-items: center;
      font-size: clamp(20px, 2.6vw, 28px);
      line-height: 1;
    }

    .header-title-text {
      white-space: nowrap;
    }

    .icon-button {
      position: relative;
      z-index: 1;
      width: 36px;
      height: 36px;
      border-radius: 18px;
      border: 1px solid rgba(255, 255, 255, 0.14);
      background: rgba(24, 24, 28, 0.7);
      color: var(--color-accent-soft);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: transform 0.4s var(--transition-soft), border-color 0.4s ease, color 0.4s ease, background 0.6s ease;
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.08);
    }

    .language-select {
      position: relative;
      z-index: 1;
    }

    .language-select select {
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      background: rgba(24, 24, 28, 0.7);
      color: rgba(245, 245, 245, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.14);
      border-radius: 16px;
      padding: 10px 21px 10px 16px;
      font-size: 13px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      font-family: var(--font-body);
      cursor: pointer;
      transition: transform 0.35s var(--transition-soft), border-color 0.4s ease, background 0.6s ease, color 0.6s ease;
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.08);
      width: auto;
      min-width: 0;
      white-space: nowrap;
    }

    .language-select select:hover {
      transform: translateY(-3px);
      border-color: rgba(216, 187, 108, 0.45);
      color: var(--color-ivory);
      box-shadow: 0 18px 34px rgba(0, 0, 0, 0.32);
    }

    .language-select select:focus-visible {
      outline: 2px solid var(--color-accent);
      outline-offset: 3px;
    }

    .language-select::after {
      content: '‚ñæ';
      position: absolute;
      right: 14px;
      top: 50%;
      transform: translateY(-50%);
      pointer-events: none;
      color: var(--color-accent-soft);
      font-size: 12px;
      transition: color 0.4s ease;
    }

    .icon-button:hover {
      transform: translateY(-3px);
      border-color: rgba(216, 187, 108, 0.65);
      color: var(--color-accent);
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.38);
    }

    .icon-button:focus-visible {
      outline: 2px solid var(--color-accent);
      outline-offset: 4px;
    }

    body[data-theme="light"] .icon-button {
      background: rgba(255, 255, 255, 0.65);
      border-color: rgba(16, 16, 16, 0.08);
      color: #7a5d1a;
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.25);
    }

    body[data-theme="light"] .language-select select {
      background: rgba(255, 255, 255, 0.72);
      color: var(--color-ink);
      border-color: rgba(16, 16, 16, 0.08);
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.35);
    }

    body[data-theme="light"] .language-select select:hover {
      color: var(--color-ink);
      box-shadow: 0 18px 34px rgba(0, 0, 0, 0.12);
    }

    body[data-theme="light"] .language-select::after {
      color: #8b6a1e;
    }

    .messages-container {
      flex: 1;
      overflow-y: auto;
      padding: 28px 28px 26px;
      display: flex;
      flex-direction: column;
      gap: 20px;
      position: relative;
      scroll-behavior: smooth;
      -webkit-overflow-scrolling: touch;
    }

    .messages-container::-webkit-scrollbar {
      width: 6px;
    }

    .messages-container::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, rgba(197, 163, 79, 0.4), rgba(216, 187, 108, 0.25));
      border-radius: 999px;
    }

    .message {
      display: flex;
      animation: messageReveal 0.6s var(--transition-soft) forwards;
      opacity: 0;
    }

    .message.user {
      justify-content: flex-end;
    }

    .message.assistant {
      justify-content: flex-start;
          flex-direction: column;
    align-items: flex-start;
    }

    .message-bubble {
      max-width: 82%;
      padding: 18px 22px;
      border-radius: var(--radius-lg);
      font-size: 17px;
      line-height: 1.75;
      letter-spacing: 0.01em;
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      transition: transform 0.4s var(--transition-soft), box-shadow 0.5s ease, border-color 0.4s ease, background 0.6s ease, color 0.6s ease;
      position: relative;
    }

    .message-bubble:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-hover);
    }

    .message.assistant .message-bubble {
      background: linear-gradient(160deg, rgba(30, 30, 34, 0.95), rgba(20, 20, 24, 0.92));
      color: rgba(248, 248, 246, 0.92);
      border-color: rgba(255, 255, 255, 0.06);
      box-shadow: 0 26px 52px rgba(0, 0, 0, 0.45);
    }

    .message.user .message-bubble {
      background: linear-gradient(160deg, rgba(248, 248, 246, 0.94), rgba(236, 234, 226, 0.9));
      color: var(--color-ink);
      border-color: rgba(197, 163, 79, 0.35);
      box-shadow: 0 26px 48px rgba(0, 0, 0, 0.32);
    }

    body[data-theme="light"] .message.assistant .message-bubble {
      background: rgba(255, 255, 255, 0.9);
      color: var(--color-ink);
      border-color: rgba(16, 16, 16, 0.08);
      box-shadow: 0 20px 36px rgba(0, 0, 0, 0.1);
    }

    body[data-theme="light"] .message.user .message-bubble {
      background: linear-gradient(160deg, rgba(245, 243, 236, 0.96), rgba(255, 255, 255, 0.92));
      border-color: rgba(197, 163, 79, 0.35);
    }

    .typing-indicator {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 14px 20px;
      border-radius: var(--radius-md);
      background: rgba(197, 163, 79, 0.16);
      border: 1px solid rgba(197, 163, 79, 0.3);
      box-shadow: 0 20px 32px rgba(0, 0, 0, 0.28);
    }

    .typing-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--color-accent-soft);
      animation: typing 1.3s infinite;
    }

    .typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-dot:nth-child(3) { animation-delay: 0.4s; }

    @keyframes typing {
      0%, 60%, 100% { transform: translateY(0); opacity: 0.6; }
      30% { transform: translateY(-6px); opacity: 1; }
    }

    .options-container {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 16px;
    }

    .options-container.initial-options {
      position: relative;
    }

    .options-container.follow-up-options {
      width: 100%;
      margin-left: 0;
      margin-right: 0;
    }

    .message.assistant .options-container.follow-up-options {
      margin-top: 18px;
    }

    .option-button {
      padding: 12px 20px;
      border-radius: 999px;
      background: rgba(28, 28, 32, 0.82);
      color: rgba(245, 245, 245, 0.9);
      border: 1px solid rgba(197, 163, 79, 0.22);
      font-size: 14px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      cursor: pointer;
      transition: transform 0.35s var(--transition-soft), background 0.5s ease, border-color 0.4s ease, color 0.4s ease;
    }

    .option-button:hover {
      transform: translateY(-3px);
      background: rgba(197, 163, 79, 0.22);
      border-color: rgba(216, 187, 108, 0.45);
      color: var(--color-ivory);
      box-shadow: 0 22px 40px rgba(0, 0, 0, 0.35);
    }

    .option-button.toggle-button {
      flex: 0 0 auto;
    }

    body[data-theme="light"] .option-button {
      background: rgba(255, 255, 255, 0.72);
      color: var(--color-ink);
      border-color: rgba(197, 163, 79, 0.32);
    }

    body[data-theme="light"] .option-button:hover {
      background: rgba(197, 163, 79, 0.28);
      color: var(--color-ink);
      box-shadow: 0 18px 34px rgba(0, 0, 0, 0.12);
    }

    .input-container {
      padding: 24px 26px;
      padding-bottom: calc(24px + env(safe-area-inset-bottom, 0px));
      display: flex;
      gap: 16px;
      align-items: center;
      background: rgba(15, 15, 18, 0.88);
      border-top: 1px solid rgba(255, 255, 255, 0.06);
      backdrop-filter: blur(20px);
      transition: background 0.8s ease, border-color 0.6s ease;
      flex-shrink: 0;
    }

    body[data-theme="light"] .input-container {
      background: rgba(253, 252, 248, 0.9);
      border-top: 1px solid rgba(0, 0, 0, 0.08);
    }

    .input-wrapper {
      flex: 1;
      position: relative;
    }

    .message-input {
      width: 100%;
      padding: 16px 22px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      background: rgba(26, 26, 32, 0.75);
      color: rgba(248, 248, 246, 0.92);
      font-size: 16px;
      letter-spacing: 0.02em;
      outline: none;
      transition: border-color 0.4s ease, background 0.5s ease, box-shadow 0.6s ease;
    }

    .message-input:focus {
      border-color: rgba(216, 187, 108, 0.65);
      background: rgba(26, 26, 32, 0.9);
      box-shadow: 0 0 0 6px rgba(197, 163, 79, 0.18);
    }

    body[data-theme="light"] .message-input {
      background: rgba(255, 255, 255, 0.75);
      border: 1px solid rgba(0, 0, 0, 0.08);
      color: var(--color-ink);
    }

    .mic-button,
    .send-button {
      width: 52px;
      height: 52px;
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      background: rgba(26, 26, 30, 0.78);
      color: var(--color-accent-soft);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: transform 0.35s var(--transition-soft), background 0.6s ease, border-color 0.4s ease, box-shadow 0.6s ease, color 0.4s ease;
      -webkit-tap-highlight-color: transparent;
    }

    .mic-button:hover,
    .send-button:hover {
      transform: translateY(-3px);
    }

    .mic-button:hover {
      border-color: rgba(216, 187, 108, 0.5);
      background: rgba(197, 163, 79, 0.22);
      color: var(--color-ivory);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.38);
    }

    .mic-button.recording {
      border-color: rgba(216, 187, 108, 0.6);
      background: rgba(216, 187, 108, 0.24);
      box-shadow: 0 22px 40px rgba(197, 163, 79, 0.35);
    }

    .send-button {
      background: linear-gradient(135deg, var(--color-accent), var(--color-accent-soft));
      border: 1px solid rgba(197, 163, 79, 0.65);
      color: var(--color-ink);
      box-shadow: 0 26px 50px rgba(197, 163, 79, 0.3);
    }

    .send-button:hover {
      background: linear-gradient(135deg, var(--color-accent-soft), #e0c874);
      border-color: rgba(216, 187, 108, 0.75);
      box-shadow: 0 30px 60px rgba(197, 163, 79, 0.4);
    }

    .mic-button:disabled,
    .send-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    body[data-theme="light"] .mic-button,
    body[data-theme="light"] .send-button {
      border-color: rgba(0, 0, 0, 0.08);
      background: rgba(255, 255, 255, 0.75);
      box-shadow: 0 18px 36px rgba(0, 0, 0, 0.12);
    }

    body[data-theme="light"] .send-button {
      color: var(--color-ink);
      background: linear-gradient(135deg, #f4e6c0, #f0dba0);
      border-color: rgba(197, 163, 79, 0.55);
      box-shadow: 0 22px 42px rgba(197, 163, 79, 0.35);
    }

    body[data-theme="light"] .mic-button:hover {
      background: rgba(197, 163, 79, 0.24);
      color: var(--color-ink);
    }

    .icon svg,
    .header-icon svg {
      display: block;
    }

    .welcome-screen {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 48px 32px;
      gap: 20px;
      min-height: 100%;
      animation: fadeIn 0.8s ease;
    }

    .welcome-icon {
      width: 74px;
      height: 74px;
      border-radius: 28px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at 40% 30%, rgba(197, 163, 79, 0.45), transparent 70%);
      color: var(--color-accent-soft);
    }

    .welcome-title {
      font-family: var(--font-display);
      font-size: 26px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
    }

    .welcome-subtitle {
      max-width: 320px;
      color: rgba(245, 245, 245, 0.75);
      font-size: 15px;
      line-height: 1.8;
    }

    body[data-theme="light"] .welcome-subtitle {
      color: rgba(24, 24, 24, 0.65);
    }

    .wine-image {
      max-width: 220px;
      border-radius: 24px;
      margin-top: 12px;
      box-shadow: 0 30px 60px rgba(0, 0, 0, 0.25);
      transition: transform 0.5s var(--transition-soft), box-shadow 0.6s ease;
    }

    .wine-image:hover {
      transform: scale(1.04);
      box-shadow: 0 36px 80px rgba(0, 0, 0, 0.4);
    }

    @media (max-width: 360px) {
      .header {
        padding: 16px 16px 14px;
      }

      .header-icon {
        width: 42px;
        height: 42px;
        border-radius: 16px;
      }

      .header-title {
        font-size: 15px;
        letter-spacing: 0.08em;
      }

      .header-actions {
        gap: 3px;
      }

      .icon-button {
        width: 30px;
        height: 30px;
      }

      .language-select select {
        padding: 6px 20px 6px 8px;
        font-size: 10px;
      }

      .language-select::after {
        right: 8px;
      }

      .messages-container {
        padding: 20px 18px;
      }

      .message-bubble {
        max-width: 90%;
        padding: 16px 18px;
        font-size: 16px;
      }

      .input-container {
        padding: 20px;
      }

      .message-input {
        padding: 14px 20px;
      }

      .mic-button,
      .send-button {
        width: 48px;
        height: 48px;
      }
    }

    @media (min-width: 768px) and (max-width: 1024px) {
      .chat-container {
        max-width: 620px;
        height: 86vh;
      }
    }

    .wine-modal {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(5, 5, 7, 0.7);
      backdrop-filter: blur(20px);
      z-index: 999;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s ease;
      color: var(--color-ivory);
    }

    body[data-theme="light"] .wine-modal {
      background: rgba(255, 255, 255, 0.78);
      color: var(--color-ink);
    }

    .wine-modal.active {
      opacity: 1;
      pointer-events: auto;
    }

    .wine-card {
      background: rgba(20, 20, 24, 0.95);
      border-radius: var(--radius-lg);
      padding: 36px 40px;
      max-width: 460px;
      width: min(90%, 460px);
      box-shadow: var(--shadow-panel);
      position: relative;
      animation: fadeIn 0.6s ease;
      border: 1px solid rgba(255, 255, 255, 0.06);
    }

    body[data-theme="light"] .wine-card {
      background: rgba(255, 255, 255, 0.95);
      border: 1px solid rgba(0, 0, 0, 0.08);
      box-shadow: 0 30px 60px rgba(0, 0, 0, 0.16);
    }

    .wine-card p {
      margin: 12px 0;
      line-height: 1.75;
    }

    .wine-card a {
      color: var(--color-accent-soft);
      font-weight: 600;
      text-decoration: none;
    }

    .wine-card a:hover {
      text-decoration: underline;
    }

    .wine-title {
      font-family: var(--font-display);
      font-size: 24px;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      margin-bottom: 18px;
      color: var(--color-accent-soft);
    }

    body[data-theme="light"] .wine-title {
      color: #8b6a1e;
    }

    .wine-close {
      position: absolute;
      top: 18px;
      right: 20px;
      background: none;
      border: none;
      color: var(--color-muted);
      font-size: 24px;
      cursor: pointer;
      transition: transform 0.3s ease, color 0.3s ease;
    }

    .wine-close:hover {
      transform: scale(1.08);
      color: var(--color-accent-soft);
    }

    .wine-name {
      display: inline-block;
      padding: 4px 14px;
      border-radius: 999px;
      background: rgba(197, 163, 79, 0.16);
      color: var(--color-accent-soft);
      font-weight: 600;
      letter-spacing: 0.05em;
      text-decoration: none;
      cursor: pointer;
      transition: background 0.4s ease, color 0.4s ease, transform 0.3s ease;
    }

    .wine-name:hover {
      background: rgba(216, 187, 108, 0.28);
      transform: translateY(-2px);
    }

    .wine-name:focus-visible {
      outline: 2px solid var(--color-accent-soft);
      outline-offset: 3px;
    }

    body[data-theme="light"] .wine-name {
      background: rgba(197, 163, 79, 0.18);
      color: #745a1a;
    }

    body[data-theme="light"] .wine-name:hover {
      background: rgba(216, 187, 108, 0.3);
    }

    @keyframes messageReveal {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(18px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @media (prefers-reduced-motion: reduce) {
      body,
      .chat-container,
      .message,
      .message-bubble,
      .option-button,
      .mic-button,
      .send-button {
        transition: none !important;
        animation: none !important;
      }
    }
  </style>
  <base target="_blank">
</head>
<body>
  <div class="chat-container">
    <header class="header">
      <div class="header-content">
        <span class="header-icon" id="headerIcon"></span>
        <div class="header-titles">
          <h1 class="header-title">
            <span class="header-flag" aria-hidden="true">üá´üá∑</span>
            <span class="header-title-text">Sommelier</span>
          </h1>
        </div>
      </div>
      <div class="header-actions">
        <button type="button" class="icon-button" id="themeToggle" aria-label="Activer le mode nuit">
          <span class="icon" id="themeIcon"></span>
        </button>
        <div class="language-select">
          <label for="languageSelect" class="sr-only">S√©lectionner la langue</label>
          <select id="languageSelect">
            <option value="en">EN</option>
            <option value="es">ES</option>
            <option value="fr">FR</option>
            <option value="de">DE</option>
            <option value="pt">PT</option>
            <option value="pl">PL</option>
            <option value="zh">ZH</option>
          </select>
        </div>
      </div>
    </header>

    <main class="messages-container" id="messages"></main>

    <form class="input-container" id="form">
      <div class="input-wrapper">
        <input
          type="text"
          id="input"
          class="message-input"
          placeholder="Demandez-moi un vin fran√ßais..."
          autocomplete="off"
        />
      </div>
      <button type="button" class="mic-button" id="micButton" aria-label="Activer la dict√©e vocale">
        <span class="icon" id="micIcon"></span>
      </button>
      <button type="submit" class="send-button" id="sendButton">
        <span class="icon" id="sendIcon"></span>
      </button>
    </form>
  </div>

  <!-- Carga de Lucide Icons -->
    <script type="module">
    import { createIcons, icons } from "https://cdn.jsdelivr.net/npm/lucide@latest/+esm";

    const initialOptions = {
      ES: {
        lunch: "üçΩÔ∏è Almuerzo",
        dinner: "üç∑ Cena",
        aperitif: "ü•Ç Aperitivo",
        special: "üéâ Ocasi√≥n especial",
        more: "‚ûï Ver m√°s",
      },
      EN: {
        lunch: "üçΩÔ∏è Lunch",
        dinner: "üç∑ Dinner",
        aperitif: "ü•Ç Aperitif",
        special: "üéâ Special occasion",
        more: "‚ûï See more",
      },
      FR: {
        lunch: "üçΩÔ∏è D√©jeuner",
        dinner: "üç∑ D√Æner",
        aperitif: "ü•Ç Ap√©ritif",
        special: "üéâ Occasion sp√©ciale",
        more: "‚ûï Voir plus",
      },
      ZH: {
        lunch: "üçΩÔ∏è ÂçàÈ§ê",
        dinner: "üç∑ ÊôöÈ§ê",
        aperitif: "ü•Ç ÂºÄËÉÉÈÖí",
        special: "üéâ ÁâπÂà´Âú∫Âêà",
        more: "‚ûï Êõ¥Â§ö",
      },
      DE: {
        lunch: "üçΩÔ∏è Mittagessen",
        dinner: "üç∑ Abendessen",
        aperitif: "ü•Ç Aperitif",
        special: "üéâ Besonderer Anlass",
        more: "‚ûï Mehr anzeigen",
      },
      PL: {
        lunch: "üçΩÔ∏è Obiad",
        dinner: "üç∑ Kolacja",
        aperitif: "ü•Ç Aperitif",
        special: "üéâ WyjƒÖtkowa okazja",
        more: "‚ûï Poka≈º wiƒôcej",
      },
      PT: {
        lunch: "üçΩÔ∏è Almo√ßo",
        dinner: "üç∑ Jantar",
        aperitif: "ü•Ç Aperitivo",
        special: "üéâ Ocasi√£o especial",
        more: "‚ûï Ver mais",
      },
    };

    const extendedOptions = {
      ES: {
        brunch: "üåÖ Brunch elegante",
        picnic: "üåÑ Picnic campestre",
        friends: "üî• Noche entre amigos",
        terrace: "üåô Cena en terraza",
        music: "üé∂ Degustaci√≥n con m√∫sica",
        autumn: "üçÅ Comida de oto√±o",
        seaside: "‚õ±Ô∏è Vacaciones junto al mar",
        cozy: "üè† Noche acogedora",
        surprise: "üéÅ Sorpr√©ndeme",
      },
      EN: {
        brunch: "üåÖ Elegant brunch",
        picnic: "üåÑ Country picnic",
        friends: "üî• Night with friends",
        terrace: "üåô Dinner on terrace",
        music: "üé∂ Musical tasting",
        autumn: "üçÅ Autumn meal",
        seaside: "‚õ±Ô∏è Seaside holidays",
        cozy: "üè† Cozy night",
        surprise: "üéÅ Surprise me",
      },
      FR: {
        brunch: "üåÖ Brunch √©l√©gant",
        picnic: "üåÑ Pique-nique champ√™tre",
        friends: "üî• Soir√©e entre amis",
        terrace: "üåô D√Æner en terrasse",
        music: "üé∂ D√©gustation musicale",
        autumn: "üçÅ Repas d‚Äôautomne",
        seaside: "‚õ±Ô∏è Vacances au bord de mer",
        cozy: "üè† Soir cocooning",
        surprise: "üéÅ Surprends-moi",
      },
      ZH: {
        brunch: "üåÖ ‰ºòÈõÖÊó©ÂçàÈ§ê",
        picnic: "üåÑ Áî∞Âõ≠ÈáéÈ§ê",
        friends: "üî• ÊúãÂèãËÅö‰ºö",
        terrace: "üåô Èú≤Âè∞ÊôöÈ§ê",
        music: "üé∂ Èü≥‰πêÂìÅÈÖí",
        autumn: "üçÅ ÁßãÂ≠£È§êÁÇπ",
        seaside: "‚õ±Ô∏è Êµ∑ËæπÂ∫¶ÂÅá",
        cozy: "üè† Ê∏©È¶®Â§úÊôö",
        surprise: "üéÅ ÁªôÊàëÊÉäÂñú",
      },
      DE: {
        brunch: "üåÖ Eleganter Brunch",
        picnic: "üåÑ Picknick im Gr√ºnen",
        friends: "üî• Abend mit Freunden",
        terrace: "üåô Abendessen auf der Terrasse",
        music: "üé∂ Degustation mit Musik",
        autumn: "üçÅ Herbstliches Essen",
        seaside: "‚õ±Ô∏è Urlaub am Meer",
        cozy: "üè† Gem√ºtlicher Abend",
        surprise: "üéÅ √úberrasch mich",
      },
      PL: {
        brunch: "üåÖ Elegancki brunch",
        picnic: "üåÑ Piknik na ≈õwie≈ºym powietrzu",
        friends: "üî• Wiecz√≥r ze znajomymi",
        terrace: "üåô Kolacja na tarasie",
        music: "üé∂ Degustacja z muzykƒÖ",
        autumn: "üçÅ Jesienny posi≈Çek",
        seaside: "‚õ±Ô∏è Wakacje nad morzem",
        cozy: "üè† Przytulny wiecz√≥r",
        surprise: "üéÅ Zaskocz mnie",
      },
      PT: {
        brunch: "üåÖ Brunch elegante",
        picnic: "üåÑ Piquenique no campo",
        friends: "üî• Noite com amigos",
        terrace: "üåô Jantar no terra√ßo",
        music: "üé∂ Degusta√ß√£o com m√∫sica",
        autumn: "üçÅ Refei√ß√£o de outono",
        seaside: "‚õ±Ô∏è F√©rias √† beira-mar",
        cozy: "üè† Noite aconchegante",
        surprise: "üéÅ Surpreenda-me",
      },
    };

    const extendedOccasionPrompts = {
      ES: {
        brunch: "Recomi√©ndame un vino franc√©s para un brunch elegante.",
        picnic: "Sugiere un vino franc√©s ideal para un picnic campestre.",
        friends: "Quiero un vino franc√©s para una noche entre amigos.",
        terrace: "Recomi√©ndame un vino franc√©s para una cena en terraza.",
        music: "Sugiere un vino franc√©s para una degustaci√≥n con m√∫sica.",
        autumn: "Recomi√©ndame un vino franc√©s para una comida de oto√±o.",
        seaside: "Sugiere un vino franc√©s para vacaciones junto al mar.",
        cozy: "Quiero un vino franc√©s para una noche acogedora.",
      },
      EN: {
        brunch: "Recommend a French wine for an elegant brunch.",
        picnic: "Suggest a French wine for a country picnic.",
        friends: "Recommend a French wine for a night with friends.",
        terrace: "Suggest a French wine for dinner on the terrace.",
        music: "Recommend a French wine for a tasting with music.",
        autumn: "Suggest a French wine for an autumn meal.",
        seaside: "Recommend a French wine for seaside holidays.",
        cozy: "Suggest a French wine for a cozy night.",
      },
      FR: {
        brunch: "Recommande-moi un vin fran√ßais pour un brunch √©l√©gant.",
        picnic: "Sugg√®re un vin fran√ßais pour un pique-nique champ√™tre.",
        friends: "Je veux un vin fran√ßais pour une soir√©e entre amis.",
        terrace: "Propose un vin fran√ßais pour un d√Æner en terrasse.",
        music: "Sugg√®re un vin fran√ßais pour une d√©gustation musicale.",
        autumn: "Recommande un vin fran√ßais pour un repas d‚Äôautomne.",
        seaside: "Sugg√®re un vin fran√ßais pour des vacances au bord de mer.",
        cozy: "Je cherche un vin fran√ßais pour une soir√©e cocooning.",
      },
      ZH: {
        brunch: "ËØ∑‰∏∫‰ºòÈõÖÁöÑÊó©ÂçàÈ§êÊé®Ëçê‰∏ÄÊ¨æÊ≥ïÂõΩËë°ËêÑÈÖí„ÄÇ",
        picnic: "ËØ∑Êé®Ëçê‰∏ÄÊ¨æÈÄÇÂêàÁî∞Âõ≠ÈáéÈ§êÁöÑÊ≥ïÂõΩËë°ËêÑÈÖí„ÄÇ",
        friends: "ËØ∑Êé®Ëçê‰∏ÄÊ¨æÈÄÇÂêàÊúãÂèãËÅö‰ºöÁöÑÊ≥ïÂõΩËë°ËêÑÈÖí„ÄÇ",
        terrace: "ËØ∑Êé®Ëçê‰∏ÄÊ¨æÈÄÇÂêàÈú≤Âè∞ÊôöÈ§êÁöÑÊ≥ïÂõΩËë°ËêÑÈÖí„ÄÇ",
        music: "ËØ∑Êé®Ëçê‰∏ÄÊ¨æÈÄÇÂêàÈü≥‰πêÂìÅÈÖíÁöÑÊ≥ïÂõΩËë°ËêÑÈÖí„ÄÇ",
        autumn: "ËØ∑Êé®Ëçê‰∏ÄÊ¨æÈÄÇÂêàÁßãÂ≠£È§êÁÇπÁöÑÊ≥ïÂõΩËë°ËêÑÈÖí„ÄÇ",
        seaside: "ËØ∑Êé®Ëçê‰∏ÄÊ¨æÈÄÇÂêàÊµ∑ËæπÂ∫¶ÂÅáÁöÑÊ≥ïÂõΩËë°ËêÑÈÖí„ÄÇ",
        cozy: "ËØ∑Êé®Ëçê‰∏ÄÊ¨æÈÄÇÂêàÊ∏©È¶®Â§úÊôöÁöÑÊ≥ïÂõΩËë°ËêÑÈÖí„ÄÇ",
      },
      DE: {
        brunch: "Empfiehl mir einen franz√∂sischen Wein f√ºr einen eleganten Brunch.",
        picnic: "Schlage einen franz√∂sischen Wein f√ºr ein Picknick im Gr√ºnen vor.",
        friends: "Ich suche einen franz√∂sischen Wein f√ºr einen Abend mit Freunden.",
        terrace: "Empfiehl mir einen franz√∂sischen Wein f√ºr ein Abendessen auf der Terrasse.",
        music: "Schlage einen franz√∂sischen Wein f√ºr eine Degustation mit Musik vor.",
        autumn: "Empfiehl mir einen franz√∂sischen Wein f√ºr ein herbstliches Essen.",
        seaside: "Schlage einen franz√∂sischen Wein f√ºr Urlaub am Meer vor.",
        cozy: "Ich m√∂chte einen franz√∂sischen Wein f√ºr einen gem√ºtlichen Abend.",
      },
      PL: {
        brunch: "Poleƒá mi francuskie wino na elegancki brunch.",
        picnic: "Zaproponuj francuskie wino na piknik na ≈õwie≈ºym powietrzu.",
        friends: "Potrzebujƒô francuskiego wina na wiecz√≥r ze znajomymi.",
        terrace: "Poleƒá francuskie wino na kolacjƒô na tarasie.",
        music: "Zaproponuj francuskie wino na degustacjƒô z muzykƒÖ.",
        autumn: "Poleƒá francuskie wino na jesienny posi≈Çek.",
        seaside: "Zaproponuj francuskie wino na wakacje nad morzem.",
        cozy: "Szukam francuskiego wina na przytulny wiecz√≥r.",
      },
      PT: {
        brunch: "Recomende um vinho franc√™s para um brunch elegante.",
        picnic: "Sugira um vinho franc√™s para um piquenique no campo.",
        friends: "Quero um vinho franc√™s para uma noite com amigos.",
        terrace: "Indique um vinho franc√™s para um jantar no terra√ßo.",
        music: "Sugira um vinho franc√™s para uma degusta√ß√£o com m√∫sica.",
        autumn: "Recomende um vinho franc√™s para uma refei√ß√£o de outono.",
        seaside: "Sugira um vinho franc√™s para f√©rias √† beira-mar.",
        cozy: "Quero um vinho franc√™s para uma noite aconchegante.",
      },
    };

    const seeLessLabels = {
      ES: "Ver menos",
      EN: "See less",
      FR: "Voir moins",
      ZH: "Êî∂Ëµ∑",
      DE: "Weniger anzeigen",
      PL: "Poka≈º mniej",
      PT: "Ver menos",
    };

    const LANGUAGE_TO_OPTION_LANG = {
      en: "EN",
      es: "ES",
      fr: "FR",
      de: "DE",
      pt: "PT",
      pl: "PL",
      zh: "ZH",
    };

    const BASE_OCCASION_KEYS = ["lunch", "dinner", "aperitif", "special"];

    // Cada idioma define su propio systemPrompt dentro de TRANSLATIONS.

    const TRANSLATIONS = {
      en: {
        htmlLang: "en",
        title: "French Wine Sommelier ¬∑ Tomos.bot",
        headerTitle: "üá´üá∑ Sommelier",
        placeholder: "Ask me for a French wine...",
        micAria: "Enable voice dictation",
        micUnavailable: "Voice recognition is not available in this browser.",
        themeToggle: {
          toLight: "Switch back to light mode",
          toDark: "Enable dark mode",
        },
        languageSelectorLabel: "Select language",
        welcome: {
          title: "Welcome to your Virtual Sommelier!",
          subtitle: "Discover remarkable French wines for every occasion.",
        },
        initialQuestion: "For which occasion would you like a recommendation?",
        initialOptions: {
          lunch: "üçΩÔ∏è Lunch",
          dinner: "üç∑ Dinner",
          aperitif: "ü•Ç Aperitif",
          special: "üéâ Special occasion",
        },
        prompts: {
          aperitif: "Suggest a French wine for an aperitif.",
        },
        mealQuestion: (mealLabel) =>
          `Perfect for ${mealLabel}, what kind of dish will you serve?`,
        mealTypes: {
          lunch: "lunch",
          dinner: "dinner",
        },
        mealOptions: {
          redMeat: {
            label: "ü•© Red meats",
            prompt: (mealLabel) =>
              `Suggest a French wine to pair with red meats for ${mealLabel}.`,
          },
          fish: {
            label: "üêü Fish",
            prompt: (mealLabel) =>
              `Suggest a French wine to pair with fish during ${mealLabel}.`,
          },
          pasta: {
            label: "üçù Pasta",
            prompt: (mealLabel) =>
              `Suggest a French wine to pair with pasta for ${mealLabel}.`,
          },
          salad: {
            label: "ü•ó Salads",
            prompt: (mealLabel) =>
              `Suggest a French wine to pair with salads at ${mealLabel}.`,
          },
        },
        specialQuestion:
          "Wonderful! What kind of special occasion would you like advice for?",
        specialOptions: {
          birthday: {
            label: "üéÇ Birthday",
            prompt: "Suggest an exceptional French wine for a birthday.",
          },
          romantic: {
            label: "üíï Romantic dinner",
            prompt: "Suggest a French wine for a romantic dinner.",
          },
          gift: {
            label: "üéÅ Gift",
            prompt: "Suggest a memorable French wine to give as a gift.",
          },
          celebration: {
            label: "üèÜ Grand celebration",
            prompt: "Suggest a prestigious French wine for a grand celebration.",
          },
        },
        followUps: {
          general: [],
          occasion: [],
          pairing: [],
          profile: [],
          region: [],
        },
        errorMessages: {
          network:
            "I'm sorry, an error occurred while connecting to the server. Please try again.",
          fetch: "Error while retrieving the response.",
        },
        vivino: "View on Vivino ‚Üí",
        modalAriaLabel: (wineName) => `Tasting details for ${wineName}`,
        modalCloseAria: "Close the wine sheet",
        modalLabels: {
          region: "Region",
          cepage: "Grape",
          aromes: "Aromas",
          bouche: "Palate",
          temperature: "Serving temperature",
          prix: "Average price",
        },
        modalSeparator: ":",
        modalSeparatorTrailingSpace: " ",
        genericWineProfile: {
          region: "France",
          cepage: "Traditional blend",
          aromes: "ripe fruit, floral notes, hint of spice",
          bouche: "balanced, harmonious finish",
          temperature: "Serve between 10 and 18 ¬∞C depending on the style",
          prix: "Check Vivino for pricing",
        },
        wineDetails: {
          "Ch√¢teau Margaux": {
            region: "Bordeaux",
            cepage: "Cabernet Sauvignon, Merlot",
            aromes: "blackcurrant, violet, noble oak",
            bouche: "silky tannins, elegant texture",
            temperature: "16-18 ¬∞C",
            prix: "~‚Ç¨250",
          },
          "Chablis Premier Cru": {
            region: "Burgundy",
            cepage: "Chardonnay",
            aromes: "citrus, white blossom, flint",
            bouche: "lively, mineral, saline finish",
            temperature: "10-12 ¬∞C",
            prix: "~‚Ç¨35",
          },
          "C√¥tes du Rh√¥ne": {
            region: "Rh√¥ne Valley",
            cepage: "Grenache, Syrah, Mourv√®dre",
            aromes: "dark fruits, sweet spices, garrigue herbs",
            bouche: "generous, ample, supple tannins",
            temperature: "15-17 ¬∞C",
            prix: "~‚Ç¨18",
          },
          "Champagne Brut": {
            region: "Champagne",
            cepage: "Pinot Noir, Chardonnay, Meunier",
            aromes: "green apple, brioche, citrus",
            bouche: "fine bubbles, vibrant freshness",
            temperature: "8-10 ¬∞C",
            prix: "~‚Ç¨40",
          },
          "Ros√© de Provence": {
            region: "Provence",
            cepage: "Grenache, Cinsault, Syrah",
            aromes: "fresh red berries, white peach, herbs",
            bouche: "light, refreshing, delicate finish",
            temperature: "8-10 ¬∞C",
            prix: "~‚Ç¨15",
          },
        },
        speechRecognitionLocale: "en-US",
        systemPrompt: `You are "Sommelier Tomos.bot", a contemporary Parisian sommelier celebrated for your sure taste and natural elegance.
You speak only in English, in a modern, fluid, and warm style‚Äîprecise but never academic.
Your answers are short (two or three sentences max), with a poetic touch, as if you were advising a guest at a Michelin-starred table in Paris.

You recommend exclusively authentic and renowned French wines.
Always mention:
‚Äì the region (Bordeaux, Burgundy, Loire, Rh√¥ne, Alsace, Champagne, Provence, etc.),
‚Äì the main grape variety,
‚Äì and a brief sensory description: aromas, texture, or sensation ("fresh and mineral", "velvety tannins", "round and elegant on the palate").

Always adapt your advice to the context: type of dish, time of day, season, or occasion (lunch, dinner, aperitif, romantic moment, celebration...).
Rarely suggest more than two or three options, each explained in one sentence.
If the wine is prestigious, hint at its reputation or style without exaggeration.

Never invent imaginary wines: cite only real French appellations or estates.
When you mention a wine, an appellation, or an estate, always wrap its name with the HTML tag <span class="wine-name"></span> so it stands out visually.
Examples: <span class="wine-name">Ch√¢teau Margaux</span>, <span class="wine-name">Chablis Premier Cru</span>, <span class="wine-name">C√¥tes du Rh√¥ne</span>.

Your tone must convey the confidence, passion, and simplicity of a great modern Parisian sommelier.

After every reply, always add a natural and elegant follow-up question to keep the conversation going.
üëâ This question must always appear on a **new line** (with a line break before it) and in **HTML bold** (wrapped in <b>...</b>), with a subtle emoji (üç∑, üçá, ü•Ç, üåø or üí´).
Use HTML tags: for example, <br><b>üç∑ Would you like something more full-bodied or lighter?</b>
Do not repeat the same type of question each time: vary your tone and intention with the context, like an attentive sommelier.

---
After each reply, automatically generate between 2 and 4 button suggestions representing possible user answers (as if they were interactive options).
You must return them in JSON format within <options> and </options> tags so the system can extract them.

Exact format:
<options>[{"label":"üç∑ Bolder","prompt":"Show me a more full-bodied wine"},{"label":"üåø Fresher","prompt":"Suggest a fresher wine"}]</options>

Buttons must be:
‚Äì relevant to the context and the last question asked by the sommelier,
‚Äì varied (no repetition between replies),
‚Äì natural and elegant in French tone,
‚Äì never generic or empty.

Example:
<options>[{"label":"üçá Burgundy","prompt":"Recommend something from Burgundy"},{"label":"üíé More exclusive","prompt":"Show me a more prestigious wine"}]</options>
---`.trim(),
      },
      es: {
        htmlLang: "es",
        title: "Sumiller de Vinos Franceses ¬∑ Tomos.bot",
        headerTitle: "üá´üá∑ Sumiller",
        placeholder: "Preg√∫ntame por un vino franc√©s...",
        micAria: "Activar dictado por voz",
        micUnavailable: "El reconocimiento de voz no est√° disponible en este navegador.",
        themeToggle: {
          toLight: "Volver al modo claro",
          toDark: "Activar el modo oscuro",
        },
        languageSelectorLabel: "Seleccionar idioma",
        welcome: {
          title: "¬°Bienvenido a tu Sumiller Virtual!",
          subtitle: "Descubre grandes vinos franceses para cada ocasi√≥n.",
        },
        initialQuestion: "¬øPara qu√© ocasi√≥n te gustar√≠a una recomendaci√≥n?",
        initialOptions: {
          lunch: "üçΩÔ∏è Almuerzo",
          dinner: "üç∑ Cena",
          aperitif: "ü•Ç Aperitivo",
          special: "üéâ Ocasi√≥n especial",
        },
        prompts: {
          aperitif: "Sugi√©reme un vino franc√©s para un aperitivo.",
        },
        mealQuestion: (mealLabel) =>
          `Perfecto para el ${mealLabel}, ¬øqu√© tipo de plato vas a servir?`,
        mealTypes: {
          lunch: "almuerzo",
          dinner: "cena",
        },
        mealOptions: {
          redMeat: {
            label: "ü•© Carnes rojas",
            prompt: (mealLabel) =>
              `Sugi√©reme un vino franc√©s para acompa√±ar carnes rojas durante el ${mealLabel}.`,
          },
          fish: {
            label: "üêü Pescados",
            prompt: (mealLabel) =>
              `Sugi√©reme un vino franc√©s para acompa√±ar pescados durante el ${mealLabel}.`,
          },
          pasta: {
            label: "üçù Pastas",
            prompt: (mealLabel) =>
              `Sugi√©reme un vino franc√©s para acompa√±ar pastas durante el ${mealLabel}.`,
          },
          salad: {
            label: "ü•ó Ensaladas",
            prompt: (mealLabel) =>
              `Sugi√©reme un vino franc√©s para acompa√±ar ensaladas durante el ${mealLabel}.`,
          },
        },
        specialQuestion:
          "¬°Magn√≠fico! ¬øPara qu√© tipo de ocasi√≥n especial deseas un consejo?",
        specialOptions: {
          birthday: {
            label: "üéÇ Cumplea√±os",
            prompt: "Sugi√©reme un vino franc√©s excepcional para un cumplea√±os.",
          },
          romantic: {
            label: "üíï Cena rom√°ntica",
            prompt: "Sugi√©reme un vino franc√©s para una cena rom√°ntica.",
          },
          gift: {
            label: "üéÅ Regalo",
            prompt: "Sugi√©reme un vino franc√©s memorable para regalar.",
          },
          celebration: {
            label: "üèÜ Gran celebraci√≥n",
            prompt: "Sugi√©reme un vino franc√©s prestigioso para una gran celebraci√≥n.",
          },
        },
        followUps: {
          general: [],
          occasion: [],
          pairing: [],
          profile: [],
          region: [],
        },
        errorMessages: {
          network:
            "Lo siento, se produjo un error al conectar con el servidor. Int√©ntalo de nuevo.",
          fetch: "Error al recuperar la respuesta.",
        },
        vivino: "Ver en Vivino ‚Üí",
        modalAriaLabel: (wineName) => `Detalles de cata de ${wineName}`,
        modalCloseAria: "Cerrar la ficha del vino",
        modalLabels: {
          region: "Regi√≥n",
          cepage: "Uva",
          aromes: "Aromas",
          bouche: "Boca",
          temperature: "Temperatura de servicio",
          prix: "Precio medio",
        },
        modalSeparator: ":",
        modalSeparatorTrailingSpace: " ",
        genericWineProfile: {
          region: "Francia",
          cepage: "Ensamblaje tradicional",
          aromes: "frutas maduras, notas florales y un toque de especias",
          bouche: "equilibrado, final armonioso",
          temperature: "Servir entre 10 y 18 ¬∞C seg√∫n el estilo",
          prix: "Consulta Vivino para conocer los precios",
        },
        wineDetails: {
          "Ch√¢teau Margaux": {
            region: "Burdeos",
            cepage: "Cabernet Sauvignon, Merlot",
            aromes: "grosella negra, violeta, roble noble",
            bouche: "taninos sedosos, textura elegante",
            temperature: "16-18 ¬∞C",
            prix: "~‚Ç¨250",
          },
          "Chablis Premier Cru": {
            region: "Borgo√±a",
            cepage: "Chardonnay",
            aromes: "c√≠tricos, flor blanca, pedernal",
            bouche: "vivo, mineral, final salino",
            temperature: "10-12 ¬∞C",
            prix: "~‚Ç¨35",
          },
          "C√¥tes du Rh√¥ne": {
            region: "Valle del R√≥dano",
            cepage: "Garnacha, Syrah, Mourv√®dre",
            aromes: "frutos negros, especias dulces, garriga",
            bouche: "goloso, amplio, taninos suaves",
            temperature: "15-17 ¬∞C",
            prix: "~‚Ç¨18",
          },
          "Champagne Brut": {
            region: "Champagne",
            cepage: "Pinot Noir, Chardonnay, Meunier",
            aromes: "manzana verde, brioche, c√≠tricos",
            bouche: "burbujas finas, frescura t√≥nica",
            temperature: "8-10 ¬∞C",
            prix: "~‚Ç¨40",
          },
          "Ros√© de Provence": {
            region: "Provenza",
            cepage: "Garnacha, Cinsault, Syrah",
            aromes: "frutos rojos frescos, melocot√≥n blanco, hierbas",
            bouche: "ligero, refrescante, final delicado",
            temperature: "8-10 ¬∞C",
            prix: "~‚Ç¨15",
          },
        },
        speechRecognitionLocale: "es-ES",
        systemPrompt: `Eres "Sommelier Tomos.bot", un sumiller parisino contempor√°neo reconocido por tu gusto impecable y tu elegancia natural.
Hablas √∫nicamente en espa√±ol, con un estilo moderno, fluido y c√°lido ‚Äî preciso pero nunca acad√©mico.
Tus respuestas son breves (m√°ximo dos o tres frases), con un toque po√©tico, como si aconsejaras a un comensal en una mesa con estrella Michelin en Par√≠s.

Recomiendas exclusivamente vinos franceses aut√©nticos y de prestigio.
Menciona siempre:
‚Äì la regi√≥n (Burdeos, Borgo√±a, Loira, R√≥dano, Alsacia, Champagne, Provenza, etc.),
‚Äì la variedad de uva principal,
‚Äì y una breve descripci√≥n sensorial: aromas, textura o sensaci√≥n ("fresco y mineral", "taninos sedosos", "boca redonda y elegante").

Adapta siempre tus consejos al contexto: tipo de plato, momento del d√≠a, estaci√≥n u ocasi√≥n (almuerzo, cena, aperitivo, cita rom√°ntica, celebraci√≥n...).
Sugiere como m√°ximo dos o tres opciones, cada una explicada en una frase.
Si el vino es prestigioso, alude sutilmente a su fama o estilo sin exagerar.

Nunca inventes vinos imaginarios: cita solo denominaciones o bodegas francesas reales.
Cuando menciones un vino, una denominaci√≥n o una bodega, rodea siempre su nombre con la etiqueta HTML <span class="wine-name"></span> para destacarlo visualmente.
Ejemplos: <span class="wine-name">Ch√¢teau Margaux</span>, <span class="wine-name">Chablis Premier Cru</span>, <span class="wine-name">C√¥tes du Rh√¥ne</span>.

Tu tono debe transmitir la confianza, la pasi√≥n y la sencillez de un gran sumiller parisino moderno.

Tras cada respuesta, a√±ade siempre una pregunta de seguimiento natural y elegante para invitar a continuar la conversaci√≥n.
üëâ Esta pregunta debe aparecer siempre en una **nueva l√≠nea** (con un salto de l√≠nea previo) y en **negrita HTML** (entre <b>...</b>), con un emoji discreto (üç∑, üçá, ü•Ç, üåø o üí´).
Usa etiquetas HTML: por ejemplo, <br><b>üç∑ ¬øPrefieres algo m√°s estructurado o m√°s ligero?</b>
No repitas siempre el mismo tipo de pregunta: var√≠a el tono y la intenci√≥n seg√∫n el contexto, como lo har√≠a un sumiller atento.

---
Despu√©s de cada respuesta, genera autom√°ticamente entre 2 y 4 sugerencias de botones que representen posibles respuestas del usuario (como si fueran opciones interactivas).
Debes devolverlas en formato JSON dentro de etiquetas <options> y </options> para que el sistema pueda extraerlas.

Formato exacto:
<options>[{"label":"üç∑ M√°s estructurado","prompt":"Mu√©strame un vino m√°s estructurado"},{"label":"üåø M√°s fresco","prompt":"Sugi√©reme un vino m√°s fresco"}]</options>

Los botones deben ser:
‚Äì relevantes al contexto y a la √∫ltima pregunta formulada por el sumiller,
‚Äì variados (no repetir entre respuestas),
‚Äì naturales y elegantes en tono franc√©s,
‚Äì nunca gen√©ricos o vac√≠os.

Ejemplo:
<options>[{"label":"üçá Borgo√±a","prompt":"Recomi√©ndame algo de Borgo√±a"},{"label":"üíé M√°s exclusivo","prompt":"Mu√©strame un vino m√°s prestigioso"}]</options>
---`.trim(),
      },
      fr: {
        htmlLang: "fr",
        title: "Sommelier de Vins Fran√ßais ¬∑ Tomos.bot",
        headerTitle: "üá´üá∑ Sommelier",
        placeholder: "Demandez-moi un vin fran√ßais...",
        micAria: "Activer la dict√©e vocale",
        micUnavailable: "La reconnaissance vocale n'est pas disponible sur ce navigateur.",
        themeToggle: {
          toLight: "Revenir au mode clair",
          toDark: "Activer le mode nuit",
        },
        languageSelectorLabel: "S√©lectionner la langue",
        welcome: {
          title: "Bienvenue aupr√®s de votre Sommelier Virtuel !",
          subtitle: "D√©couvrez les plus grands vins fran√ßais pour chaque occasion.",
        },
        initialQuestion: "Pour quelle occasion souhaitez-vous une recommandation ?",
        initialOptions: {
          lunch: "üçΩÔ∏è D√©jeuner",
          dinner: "üç∑ D√Æner",
          aperitif: "ü•Ç Ap√©ritif",
          special: "üéâ Occasion sp√©ciale",
        },
        prompts: {
          aperitif: "Sugg√®re-moi un vin fran√ßais pour un ap√©ritif.",
        },
        mealQuestion: (mealLabel) =>
          `Parfait pour le ${mealLabel}, quel type de plat servirez-vous ?`,
        mealTypes: {
          lunch: "d√©jeuner",
          dinner: "d√Æner",
        },
        mealOptions: {
          redMeat: {
            label: "ü•© Viandes rouges",
            prompt: (mealLabel) =>
              `Sugg√®re-moi un vin fran√ßais pour accompagner des viandes rouges lors du ${mealLabel}.`,
          },
          fish: {
            label: "üêü Poissons",
            prompt: (mealLabel) =>
              `Sugg√®re-moi un vin fran√ßais pour accompagner des poissons lors du ${mealLabel}.`,
          },
          pasta: {
            label: "üçù P√¢tes",
            prompt: (mealLabel) =>
              `Sugg√®re-moi un vin fran√ßais pour accompagner des p√¢tes lors du ${mealLabel}.`,
          },
          salad: {
            label: "ü•ó Salades",
            prompt: (mealLabel) =>
              `Sugg√®re-moi un vin fran√ßais pour accompagner des salades lors du ${mealLabel}.`,
          },
        },
        specialQuestion:
          "Magnifique ! Pour quel type d'occasion sp√©ciale souhaitez-vous √™tre conseill√© ?",
        specialOptions: {
          birthday: {
            label: "üéÇ Anniversaire",
            prompt: "Sugg√®re-moi un vin fran√ßais d'exception pour un anniversaire.",
          },
          romantic: {
            label: "üíï D√Æner romantique",
            prompt: "Sugg√®re-moi un vin fran√ßais pour un d√Æner romantique.",
          },
          gift: {
            label: "üéÅ Cadeau",
            prompt: "Sugg√®re-moi un vin fran√ßais m√©morable √† offrir.",
          },
          celebration: {
            label: "üèÜ Grande c√©l√©bration",
            prompt: "Sugg√®re-moi un vin fran√ßais prestigieux pour une grande c√©l√©bration.",
          },
        },
        followUps: {
          general: [],
          occasion: [],
          pairing: [],
          profile: [],
          region: [],
        },
        errorMessages: {
          network:
            "Je suis d√©sol√©, une erreur est survenue lors de la connexion au serveur. Veuillez r√©essayer.",
          fetch: "Erreur lors de la r√©cup√©ration de la r√©ponse.",
        },
        vivino: "Voir sur Vivino ‚Üí",
        modalAriaLabel: (wineName) => `D√©tails de d√©gustation pour ${wineName}`,
        modalCloseAria: "Fermer la fiche du vin",
        modalLabels: {
          region: "R√©gion",
          cepage: "C√©page",
          aromes: "Ar√¥mes",
          bouche: "Bouche",
          temperature: "Temp√©rature",
          prix: "Prix moyen",
        },
        modalSeparator: " :",
        modalSeparatorTrailingSpace: " ",
        genericWineProfile: {
          region: "France",
          cepage: "Assemblage traditionnel",
          aromes: "fruits m√ªrs, notes florales et touche d'√©pices",
          bouche: "√©quilibr√©e, finale harmonieuse",
          temperature: "Servir entre 10 et 18 ¬∞C selon le style",
          prix: "Consultez Vivino pour les prix",
        },
        wineDetails: {
          "Ch√¢teau Margaux": {
            region: "Bordeaux",
            cepage: "Cabernet Sauvignon, Merlot",
            aromes: "cassis, violette, bois noble",
            bouche: "tanins soyeux, texture √©l√©gante",
            temperature: "16-18 ¬∞C",
            prix: "~250 ‚Ç¨",
          },
          "Chablis Premier Cru": {
            region: "Bourgogne",
            cepage: "Chardonnay",
            aromes: "agrumes, fleur blanche, pierre √† fusil",
            bouche: "vif, min√©ral, finale saline",
            temperature: "10-12 ¬∞C",
            prix: "~35 ‚Ç¨",
          },
          "C√¥tes du Rh√¥ne": {
            region: "Vall√©e du Rh√¥ne",
            cepage: "Grenache, Syrah, Mourv√®dre",
            aromes: "fruits noirs, √©pices douces, garrigue",
            bouche: "gourmand, ample, tanins souples",
            temperature: "15-17 ¬∞C",
            prix: "~18 ‚Ç¨",
          },
          "Champagne Brut": {
            region: "Champagne",
            cepage: "Pinot Noir, Chardonnay, Meunier",
            aromes: "pomme verte, brioche, agrumes",
            bouche: "bulles fines, fra√Æcheur tonique",
            temperature: "8-10 ¬∞C",
            prix: "~40 ‚Ç¨",
          },
          "Ros√© de Provence": {
            region: "Provence",
            cepage: "Grenache, Cinsault, Syrah",
            aromes: "fruits rouges frais, p√™che blanche, herbes",
            bouche: "l√©ger, d√©salt√©rant, finale d√©licate",
            temperature: "8-10 ¬∞C",
            prix: "~15 ‚Ç¨",
          },
        },
        speechRecognitionLocale: "fr-FR",
        systemPrompt: `Tu es "Sommelier Tomos.bot", un sommelier parisien contemporain reconnu pour ton go√ªt s√ªr et ton √©l√©gance naturelle.
Tu t'exprimes uniquement en fran√ßais, dans un style moderne, fluide et chaleureux ‚Äî pr√©cis sans √™tre acad√©mique.
Tes r√©ponses sont courtes (deux √† trois phrases maximum), avec une touche po√©tique, comme si tu conseillais un convive dans un restaurant √©toil√© √† Paris.

Tu recommandes exclusivement des vins fran√ßais authentiques et renomm√©s.
Mentionne toujours :
‚Äì la r√©gion (Bordeaux, Bourgogne, Loire, Rh√¥ne, Alsace, Champagne, Provence, etc.),
‚Äì le c√©page principal,
‚Äì et une br√®ve description sensorielle : ar√¥mes, texture ou sensation (¬´ frais et min√©ral ¬ª, ¬´ tanins soyeux ¬ª, ¬´ bouche ample et √©l√©gante ¬ª).

Adapte toujours tes conseils au contexte : type de plat, moment de la journ√©e, saison ou occasion (d√©jeuner, d√Æner, ap√©ritif, rendez-vous romantique, c√©l√©bration...).
Propose au maximum deux ou trois options, chacune expliqu√©e en une phrase.
Si le vin est prestigieux, sugg√®re discr√®tement sa r√©putation ou son style sans exag√©ration.

N'invente jamais de vins imaginaires : ne cite que des appellations ou des domaines fran√ßais r√©els.
Lorsque tu cites un vin, une appellation ou un domaine, encadre toujours son nom avec la balise HTML <span class="wine-name"></span> pour le mettre en valeur visuellement.
Exemples : <span class="wine-name">Ch√¢teau Margaux</span>, <span class="wine-name">Chablis Premier Cru</span>, <span class="wine-name">C√¥tes du Rh√¥ne</span>.

Ton ton doit refl√©ter la confiance, la passion et la simplicit√© d'un grand sommelier parisien moderne.

Apr√®s chaque r√©ponse, ajoute toujours une question de relance naturelle et √©l√©gante pour inviter √† poursuivre la conversation.
üëâ Cette question doit toujours appara√Ætre sur une **nouvelle ligne** (avec un saut de ligne au pr√©alable) et en **gras HTML** (entre <b>...</b>), avec un emoji subtil (üç∑, üçá, ü•Ç, üåø ou üí´).
Utilise les balises HTML : par exemple, <br><b>üç∑ Souhaitez-vous quelque chose de plus charpent√© ou de plus l√©ger ?</b>
Ne r√©p√®te pas toujours le m√™me type de question : varie le ton et l'intention selon le contexte, comme le ferait un sommelier attentionn√©.

---
Apr√®s chaque r√©ponse, g√©n√®re automatiquement entre 2 et 4 suggestions de boutons repr√©sentant d'√©ventuelles r√©ponses de l'utilisateur (comme des options interactives).
Tu dois les renvoyer en format JSON √† l'int√©rieur des balises <options> et </options> afin que le syst√®me puisse les extraire.

Format exact :
<options>[{"label":"üç∑ Plus de structure","prompt":"Propose-moi un vin plus charpent√©"},{"label":"üåø Plus de fra√Æcheur","prompt":"Sugg√®re-moi un vin plus frais"}]</options>

Les boutons doivent √™tre :
‚Äì pertinents par rapport au contexte et √† la derni√®re question pos√©e par le sommelier,
‚Äì vari√©s (pas de r√©p√©tition d'une r√©ponse √† l'autre),
‚Äì naturels et √©l√©gants dans un ton fran√ßais,
‚Äì jamais g√©n√©riques ou vides.

Exemple :
<options>[{"label":"üçá Bourgogne","prompt":"Recommande-moi quelque chose de Bourgogne"},{"label":"üíé Plus prestigieux","prompt":"Montre-moi un vin plus prestigieux"}]</options>
---`.trim(),
      },
      de: {
        htmlLang: "de",
        title: "Franz√∂sischer Weinsommelier ¬∑ Tomos.bot",
        headerTitle: "üá´üá∑ Sommelier",
        placeholder: "Frag mich nach einem franz√∂sischen Wein...",
        micAria: "Spracherkennung aktivieren",
        micUnavailable: "Die Spracherkennung ist in diesem Browser nicht verf√ºgbar.",
        themeToggle: {
          toLight: "Zur√ºck zum hellen Modus wechseln",
          toDark: "Dunkelmodus aktivieren",
        },
        languageSelectorLabel: "Sprache ausw√§hlen",
        welcome: {
          title: "Willkommen bei deinem virtuellen Sommelier!",
          subtitle: "Entdecke bemerkenswerte franz√∂sische Weine f√ºr jeden Anlass.",
        },
        initialQuestion: "F√ºr welchen Anlass h√§ttest du gern eine Empfehlung?",
        initialOptions: {
          lunch: "üçΩÔ∏è Mittagessen",
          dinner: "üç∑ Abendessen",
          aperitif: "ü•Ç Aperitif",
          special: "üéâ Besonderer Anlass",
        },
        prompts: {
          aperitif: "Empfiehl mir einen franz√∂sischen Wein f√ºr einen Aperitif.",
        },
        mealQuestion: (mealLabel) =>
          `Perfekt f√ºr ${mealLabel}, welches Gericht wirst du servieren?`,
        mealTypes: {
          lunch: "Mittagessen",
          dinner: "Abendessen",
        },
        mealOptions: {
          redMeat: {
            label: "ü•© Rotes Fleisch",
            prompt: (mealLabel) =>
              `Empfiehl einen franz√∂sischen Wein, der zu rotem Fleisch beim ${mealLabel} passt.`,
          },
          fish: {
            label: "üêü Fisch",
            prompt: (mealLabel) =>
              `Empfiehl einen franz√∂sischen Wein, der zu Fisch beim ${mealLabel} passt.`,
          },
          pasta: {
            label: "üçù Pasta",
            prompt: (mealLabel) =>
              `Empfiehl einen franz√∂sischen Wein, der zu Pasta beim ${mealLabel} passt.`,
          },
          salad: {
            label: "ü•ó Salate",
            prompt: (mealLabel) =>
              `Empfiehl einen franz√∂sischen Wein, der zu Salaten beim ${mealLabel} passt.`,
          },
        },
        specialQuestion:
          "Gro√üartig! F√ºr welche Art von besonderem Anlass h√§ttest du gern einen Rat?",
        specialOptions: {
          birthday: {
            label: "üéÇ Geburtstag",
            prompt: "Empfiehl einen au√üergew√∂hnlichen franz√∂sischen Wein f√ºr einen Geburtstag.",
          },
          romantic: {
            label: "üíï Romantisches Dinner",
            prompt: "Empfiehl einen franz√∂sischen Wein f√ºr ein romantisches Dinner.",
          },
          gift: {
            label: "üéÅ Geschenk",
            prompt: "Empfiehl einen unvergesslichen franz√∂sischen Wein zum Verschenken.",
          },
          celebration: {
            label: "üèÜ Gro√üe Feier",
            prompt: "Empfiehl einen prestigetr√§chtigen franz√∂sischen Wein f√ºr eine gro√üe Feier.",
          },
        },
        errorMessages: {
          network:
            "Es tut mir leid, beim Verbinden mit dem Server ist ein Fehler aufgetreten. Bitte versuche es erneut.",
          fetch: "Fehler beim Abrufen der Antwort.",
        },
        vivino: "Auf Vivino ansehen ‚Üí",
        modalAriaLabel: (wineName) => `Verkostungsnotizen f√ºr ${wineName}`,
        modalCloseAria: "Weinkarte schlie√üen",
        modalLabels: {
          region: "Region",
          cepage: "Rebsorte",
          aromes: "Aromen",
          bouche: "Gaumen",
          temperature: "Serviertemperatur",
          prix: "Durchschnittspreis",
        },
        modalSeparator: ":",
        modalSeparatorTrailingSpace: " ",
        genericWineProfile: {
          region: "Frankreich",
          cepage: "Traditionelle Cuv√©e",
          aromes: "reife Frucht, florale Noten, Hauch von Gew√ºrz",
          bouche: "ausgewogen, harmonischer Abgang",
          temperature: "Je nach Stil zwischen 10 und 18 ¬∞C servieren",
          prix: "Preise auf Vivino pr√ºfen",
        },
        wineDetails: {
          "Ch√¢teau Margaux": {
            region: "Bordeaux",
            cepage: "Cabernet Sauvignon, Merlot",
            aromes: "schwarze Johannisbeere, Veilchen, edles Eichenholz",
            bouche: "seidige Tannine, elegante Textur",
            temperature: "16-18 ¬∞C",
            prix: "~‚Ç¨250",
          },
          "Chablis Premier Cru": {
            region: "Burgund",
            cepage: "Chardonnay",
            aromes: "Zitrus, wei√üe Bl√ºte, Feuerstein",
            bouche: "lebhaft, mineralisch, salziger Abgang",
            temperature: "10-12 ¬∞C",
            prix: "~‚Ç¨35",
          },
          "C√¥tes du Rh√¥ne": {
            region: "Rh√¥ne-Tal",
            cepage: "Grenache, Syrah, Mourv√®dre",
            aromes: "dunkle Fr√ºchte, s√º√üe Gew√ºrze, Kr√§uter der Garrigue",
            bouche: "gener√∂s, vollmundig, geschmeidige Tannine",
            temperature: "15-17 ¬∞C",
            prix: "~‚Ç¨18",
          },
          "Champagne Brut": {
            region: "Champagne",
            cepage: "Pinot Noir, Chardonnay, Meunier",
            aromes: "gr√ºner Apfel, Brioche, Zitrus",
            bouche: "feine Perlage, lebendige Frische",
            temperature: "8-10 ¬∞C",
            prix: "~‚Ç¨40",
          },
          "Ros√© de Provence": {
            region: "Provence",
            cepage: "Grenache, Cinsault, Syrah",
            aromes: "frische rote Beeren, wei√üer Pfirsich, Kr√§uter",
            bouche: "leicht, erfrischend, zarter Abgang",
            temperature: "8-10 ¬∞C",
            prix: "~‚Ç¨15",
          },
        },
        speechRecognitionLocale: "de-DE",
        systemPrompt: `Du bist "Sommelier Tomos.bot", ein zeitgen√∂ssischer Pariser Sommelier, der f√ºr seinen sicheren Geschmack und seine nat√ºrliche Eleganz bekannt ist.
Du sprichst ausschlie√ülich auf Deutsch, in einem modernen, flie√üenden und warmen Stil ‚Äì pr√§zise, aber nie akademisch.
Deine Antworten sind kurz (maximal zwei bis drei S√§tze) und poetisch, so als w√ºrdest du einen Gast an einem Michelin-Stern-Tisch in Paris beraten.

Du empfiehlst ausschlie√ülich authentische und renommierte franz√∂sische Weine.
Erw√§hne immer:
‚Äì die Region (Bordeaux, Burgund, Loire, Rh√¥ne, Elsass, Champagne, Provence usw.),
‚Äì die Hauptrebsorte,
‚Äì sowie eine kurze sensorische Beschreibung: Aromen, Textur oder Eindruck ("frisch und mineralisch", "seidige Tannine", "runder, eleganter Gaumen").

Passe deine Empfehlungen stets dem Kontext an: Art des Gerichts, Tageszeit, Jahreszeit oder Anlass (Mittagessen, Abendessen, Aperitif, romantischer Moment, Feier ...).
Schlage h√∂chstens zwei bis drei Optionen vor, jede in einem Satz erkl√§rt.
Wenn der Wein prestigetr√§chtig ist, deute seinen Ruf oder Stil dezent an, ohne zu √ºbertreiben.

Erfinde niemals imagin√§re Weine: Nenne nur reale franz√∂sische Appellationen oder Weing√ºter.
Wann immer du einen Wein, eine Appellation oder ein Weingut erw√§hnst, versieh den Namen mit dem HTML-Tag <span class="wine-name"></span>, damit er optisch hervorsticht.
Beispiele: <span class="wine-name">Ch√¢teau Margaux</span>, <span class="wine-name">Chablis Premier Cru</span>, <span class="wine-name">C√¥tes du Rh√¥ne</span>.

Dein Ton muss die Selbstsicherheit, Leidenschaft und schlichte Eleganz eines gro√üen modernen Pariser Sommeliers vermitteln.

F√ºge nach jeder Antwort stets eine nat√ºrliche, elegante R√ºckfrage hinzu, um das Gespr√§ch lebendig zu halten.
üëâ Diese Frage muss immer in einer **neuen Zeile** erscheinen (mit einem vorherigen Zeilenumbruch) und in **HTML-Fettschrift** (zwischen <b>...</b>) stehen, begleitet von einem dezenten Emoji (üç∑, üçá, ü•Ç, üåø oder üí´).
Nutze HTML-Tags: zum Beispiel, <br><b>üç∑ Darf es etwas kr√§ftigeres oder lieber leichteres sein?</b>
Wiederhole nicht immer denselben Fragentyp: Variiere Tonfall und Intention je nach Kontext, wie es ein aufmerksamer Sommelier tun w√ºrde.

---
Generiere nach jeder Antwort automatisch 2 bis 4 Button-Vorschl√§ge, die m√∂gliche Antworten des Nutzers repr√§sentieren (wie interaktive Optionen).
Gib sie im JSON-Format zwischen den Tags <options> und </options> aus, damit das System sie extrahieren kann.

Genaues Format:
<options>[{"label":"üç∑ Kr√§ftiger","prompt":"Zeig mir einen kr√§ftigeren Wein"},{"label":"üåø Frischer","prompt":"Schlage mir einen frischeren Wein vor"}]</options>

Die Buttons m√ºssen:
‚Äì zum Kontext und zur letzten Frage des Sommeliers passen,
‚Äì abwechslungsreich sein (keine Wiederholungen von Antwort zu Antwort),
‚Äì nat√ºrlich und elegant im franz√∂sischen Tonfall wirken,
‚Äì niemals generisch oder inhaltsleer sein.

Beispiel:
<options>[{"label":"üçá Burgund","prompt":"Empfiehl mir etwas aus dem Burgund"},{"label":"üíé Exklusiver","prompt":"Zeig mir einen prestigetr√§chtigeren Wein"}]</options>
---`.trim(),
      },
      pt: {
        htmlLang: "pt",
        title: "Sommelier de Vinhos Franceses ¬∑ Tomos.bot",
        headerTitle: "üá´üá∑ Sommelier",
        placeholder: "Pe√ßa-me um vinho franc√™s...",
        micAria: "Ativar ditado por voz",
        micUnavailable: "O reconhecimento de voz n√£o est√° dispon√≠vel neste navegador.",
        themeToggle: {
          toLight: "Voltar ao modo claro",
          toDark: "Ativar o modo escuro",
        },
        languageSelectorLabel: "Selecionar idioma",
        welcome: {
          title: "Bem-vindo ao seu Sommelier Virtual!",
          subtitle: "Descubra grandes vinhos franceses para cada ocasi√£o.",
        },
        initialQuestion: "Para qual ocasi√£o voc√™ deseja uma recomenda√ß√£o?",
        initialOptions: {
          lunch: "üçΩÔ∏è Almo√ßo",
          dinner: "üç∑ Jantar",
          aperitif: "ü•Ç Aperitivo",
          special: "üéâ Ocasi√£o especial",
        },
        prompts: {
          aperitif: "Indique um vinho franc√™s para um aperitivo.",
        },
        mealQuestion: (mealLabel) =>
          `Perfeito para o ${mealLabel}, que tipo de prato ser√° servido?`,
        mealTypes: {
          lunch: "almo√ßo",
          dinner: "jantar",
        },
        mealOptions: {
          redMeat: {
            label: "ü•© Carnes vermelhas",
            prompt: (mealLabel) =>
              `Indique um vinho franc√™s para harmonizar com carnes vermelhas durante o ${mealLabel}.`,
          },
          fish: {
            label: "üêü Peixes",
            prompt: (mealLabel) =>
              `Indique um vinho franc√™s para acompanhar peixes no ${mealLabel}.`,
          },
          pasta: {
            label: "üçù Massas",
            prompt: (mealLabel) =>
              `Indique um vinho franc√™s para harmonizar com massas no ${mealLabel}.`,
          },
          salad: {
            label: "ü•ó Saladas",
            prompt: (mealLabel) =>
              `Indique um vinho franc√™s para acompanhar saladas no ${mealLabel}.`,
          },
        },
        specialQuestion:
          "Magn√≠fico! Para qual tipo de ocasi√£o especial voc√™ deseja um conselho?",
        specialOptions: {
          birthday: {
            label: "üéÇ Anivers√°rio",
            prompt: "Indique um vinho franc√™s excepcional para um anivers√°rio.",
          },
          romantic: {
            label: "üíï Jantar rom√¢ntico",
            prompt: "Indique um vinho franc√™s para um jantar rom√¢ntico.",
          },
          gift: {
            label: "üéÅ Presente",
            prompt: "Indique um vinho franc√™s memor√°vel para presentear.",
          },
          celebration: {
            label: "üèÜ Grande celebra√ß√£o",
            prompt: "Indique um vinho franc√™s prestigioso para uma grande celebra√ß√£o.",
          },
        },
        errorMessages: {
          network:
            "Desculpe, ocorreu um erro ao conectar ao servidor. Tente novamente.",
          fetch: "Erro ao obter a resposta.",
        },
        vivino: "Ver no Vivino ‚Üí",
        modalAriaLabel: (wineName) => `Detalhes de degusta√ß√£o de ${wineName}`,
        modalCloseAria: "Fechar a ficha do vinho",
        modalLabels: {
          region: "Regi√£o",
          cepage: "Uva",
          aromes: "Aromas",
          bouche: "Paladar",
          temperature: "Temperatura de servi√ßo",
          prix: "Pre√ßo m√©dio",
        },
        modalSeparator: ":",
        modalSeparatorTrailingSpace: " ",
        genericWineProfile: {
          region: "Fran√ßa",
          cepage: "Corte tradicional",
          aromes: "frutas maduras, notas florais e toque de especiarias",
          bouche: "equilibrado, final harmonioso",
          temperature: "Servir entre 10 e 18 ¬∞C conforme o estilo",
          prix: "Consulte o Vivino para pre√ßos",
        },
        wineDetails: {
          "Ch√¢teau Margaux": {
            region: "Bord√©us",
            cepage: "Cabernet Sauvignon, Merlot",
            aromes: "groselha preta, violeta, carvalho nobre",
            bouche: "taninos sedosos, textura elegante",
            temperature: "16-18 ¬∞C",
            prix: "~‚Ç¨250",
          },
          "Chablis Premier Cru": {
            region: "Borgonha",
            cepage: "Chardonnay",
            aromes: "c√≠tricos, flor branca, pedra de isqueiro",
            bouche: "vivo, mineral, final salino",
            temperature: "10-12 ¬∞C",
            prix: "~‚Ç¨35",
          },
          "C√¥tes du Rh√¥ne": {
            region: "Vale do R√≥dano",
            cepage: "Grenache, Syrah, Mourv√®dre",
            aromes: "frutas escuras, especiarias doces, ervas de garrigue",
            bouche: "generoso, amplo, taninos macios",
            temperature: "15-17 ¬∞C",
            prix: "~‚Ç¨18",
          },
          "Champagne Brut": {
            region: "Champagne",
            cepage: "Pinot Noir, Chardonnay, Meunier",
            aromes: "ma√ß√£ verde, brioche, c√≠tricos",
            bouche: "borbulhas finas, frescor vibrante",
            temperature: "8-10 ¬∞C",
            prix: "~‚Ç¨40",
          },
          "Ros√© de Provence": {
            region: "Proven√ßa",
            cepage: "Grenache, Cinsault, Syrah",
            aromes: "frutas vermelhas frescas, p√™ssego branco, ervas",
            bouche: "leve, refrescante, final delicado",
            temperature: "8-10 ¬∞C",
            prix: "~‚Ç¨15",
          },
        },
        speechRecognitionLocale: "pt-PT",
        systemPrompt: `Voc√™ √© "Sommelier Tomos.bot", um sommelier parisiense contempor√¢neo reconhecido pelo gosto apurado e pela eleg√¢ncia natural.
Voc√™ fala apenas em portugu√™s, com um estilo moderno, fluido e acolhedor ‚Äî preciso sem ser acad√™mico.
Suas respostas s√£o breves (duas ou tr√™s frases no m√°ximo), com um toque po√©tico, como se orientasse um convidado numa mesa estrelada em Paris.

Voc√™ recomenda exclusivamente vinhos franceses aut√™nticos e de prest√≠gio.
Mencione sempre:
‚Äì a regi√£o (Bordeaux, Borgonha, Loire, Rh√¥ne, Als√°cia, Champagne, Proven√ßa etc.),
‚Äì a uva principal,
‚Äì e uma breve descri√ß√£o sensorial: aromas, textura ou sensa√ß√£o ("fresco e mineral", "taninos aveludados", "paladar redondo e elegante").

Adapte sempre seus conselhos ao contexto: tipo de prato, momento do dia, esta√ß√£o ou ocasi√£o (almo√ßo, jantar, aperitivo, encontro rom√¢ntico, celebra√ß√£o...).
Sugira no m√°ximo duas ou tr√™s op√ß√µes, cada uma explicada em uma frase.
Se o vinho for prestigioso, fa√ßa alus√£o discreta √† sua fama ou estilo, sem exagero.

Nunca invente vinhos imagin√°rios: cite apenas denomina√ß√µes ou vin√≠colas francesas reais.
Ao mencionar um vinho, uma denomina√ß√£o ou uma vin√≠cola, envolva sempre o nome com a tag HTML <span class="wine-name"></span> para destac√°-lo visualmente.
Exemplos: <span class="wine-name">Ch√¢teau Margaux</span>, <span class="wine-name">Chablis Premier Cru</span>, <span class="wine-name">C√¥tes du Rh√¥ne</span>.

Seu tom deve transmitir a confian√ßa, a paix√£o e a simplicidade de um grande sommelier parisiense moderno.

Ap√≥s cada resposta, acrescente sempre uma pergunta de acompanhamento natural e elegante para manter a conversa.
üëâ Essa pergunta deve aparecer sempre em uma **nova linha** (com uma quebra de linha antes) e em **negrito HTML** (entre <b>...</b>), acompanhada de um emoji discreto (üç∑, üçá, ü•Ç, üåø ou üí´).
Use tags HTML: por exemplo, <br><b>üç∑ Prefere algo mais estruturado ou mais leve?</b>
N√£o repita sempre o mesmo tipo de pergunta: varie o tom e a inten√ß√£o conforme o contexto, como faria um sommelier atento.

---
Ap√≥s cada resposta, gere automaticamente entre 2 e 4 sugest√µes de bot√µes que representem poss√≠veis respostas do usu√°rio (como se fossem op√ß√µes interativas).
Devolva-as em formato JSON dentro das tags <options> e </options> para que o sistema possa extra√≠-las.

Formato exato:
<options>[{"label":"üç∑ Mais estrutura","prompt":"Mostre-me um vinho mais encorpado"},{"label":"üåø Mais frescor","prompt":"Sugira-me um vinho mais fresco"}]</options>

Os bot√µes devem ser:
‚Äì relevantes para o contexto e a √∫ltima pergunta formulada pelo sommelier,
‚Äì variados (sem repetir entre respostas),
‚Äì naturais e elegantes em tom franc√™s,
‚Äì nunca gen√©ricos ou vazios.

Exemplo:
<options>[{"label":"üçá Borgonha","prompt":"Recomende algo da Borgonha"},{"label":"üíé Mais exclusivo","prompt":"Mostre-me um vinho mais prestigioso"}]</options>
---`.trim(),
      },
      pl: {
        htmlLang: "pl",
        title: "Sommelier Win Francuskich ¬∑ Tomos.bot",
        headerTitle: "üá´üá∑ Sommelier",
        placeholder: "Zapytaj mnie o francuskie wino...",
        micAria: "W≈ÇƒÖcz dyktowanie g≈Çosowe",
        micUnavailable: "Rozpoznawanie mowy nie jest dostƒôpne w tej przeglƒÖdarce.",
        themeToggle: {
          toLight: "Powr√≥t do jasnego trybu",
          toDark: "W≈ÇƒÖcz tryb ciemny",
        },
        languageSelectorLabel: "Wybierz jƒôzyk",
        welcome: {
          title: "Witamy u Twojego Wirtualnego Sommeliera!",
          subtitle: "Odkryj znakomite francuskie wina na ka≈ºdƒÖ okazjƒô.",
        },
        initialQuestion: "Na jakƒÖ okazjƒô chcesz otrzymaƒá rekomendacjƒô?",
        initialOptions: {
          lunch: "üçΩÔ∏è Lunch",
          dinner: "üç∑ Kolacja",
          aperitif: "ü•Ç Aperitif",
          special: "üéâ Specjalna okazja",
        },
        prompts: {
          aperitif: "Poleƒá mi francuskie wino na aperitif.",
        },
        mealQuestion: (mealLabel) =>
          `≈öwietnie pasuje do ${mealLabel}, jakie danie podasz?`,
        mealTypes: {
          lunch: "lunchu",
          dinner: "kolacji",
        },
        mealOptions: {
          redMeat: {
            label: "ü•© Czerwone miƒôsa",
            prompt: (mealLabel) =>
              `Poleƒá mi francuskie wino do czerwonych miƒôs podczas ${mealLabel}.`,
          },
          fish: {
            label: "üêü Ryby",
            prompt: (mealLabel) =>
              `Poleƒá mi francuskie wino do ryb podczas ${mealLabel}.`,
          },
          pasta: {
            label: "üçù Makarony",
            prompt: (mealLabel) =>
              `Poleƒá mi francuskie wino do makaron√≥w podczas ${mealLabel}.`,
          },
          salad: {
            label: "ü•ó Sa≈Çatki",
            prompt: (mealLabel) =>
              `Poleƒá mi francuskie wino do sa≈Çatek podczas ${mealLabel}.`,
          },
        },
        specialQuestion:
          "Wspaniale! Na jaki rodzaj specjalnej okazji potrzebujesz porady?",
        specialOptions: {
          birthday: {
            label: "üéÇ Urodziny",
            prompt: "Poleƒá wyjƒÖtkowe francuskie wino na urodziny.",
          },
          romantic: {
            label: "üíï Romantyczna kolacja",
            prompt: "Poleƒá francuskie wino na romantycznƒÖ kolacjƒô.",
          },
          gift: {
            label: "üéÅ Prezent",
            prompt: "Poleƒá niezapomniane francuskie wino na prezent.",
          },
          celebration: {
            label: "üèÜ Wielkie ≈õwiƒôtowanie",
            prompt: "Poleƒá presti≈ºowe francuskie wino na wielkie ≈õwiƒôtowanie.",
          },
        },
        errorMessages: {
          network:
            "Przepraszam, wystƒÖpi≈Ç b≈ÇƒÖd podczas ≈ÇƒÖczenia z serwerem. Spr√≥buj ponownie.",
          fetch: "B≈ÇƒÖd podczas pobierania odpowiedzi.",
        },
        vivino: "Zobacz na Vivino ‚Üí",
        modalAriaLabel: (wineName) => `Szczeg√≥≈Çy degustacji dla ${wineName}`,
        modalCloseAria: "Zamknij kartƒô wina",
        modalLabels: {
          region: "Region",
          cepage: "Szczep",
          aromes: "Aromaty",
          bouche: "Smak",
          temperature: "Temperatura podania",
          prix: "≈örednia cena",
        },
        modalSeparator: ":",
        modalSeparatorTrailingSpace: " ",
        genericWineProfile: {
          region: "Francja",
          cepage: "Tradycyjna kupa≈ºa",
          aromes: "dojrza≈Çe owoce, nuty kwiatowe i odrobina przypraw",
          bouche: "zr√≥wnowa≈ºone, harmonijne zako≈Ñczenie",
          temperature: "Podawaj w temperaturze 10‚Äì18 ¬∞C w zale≈ºno≈õci od stylu",
          prix: "Sprawd≈∫ ceny w serwisie Vivino",
        },
        wineDetails: {
          "Ch√¢teau Margaux": {
            region: "Bordeaux",
            cepage: "Cabernet Sauvignon, Merlot",
            aromes: "czarna porzeczka, fio≈Çek, szlachetne drewno",
            bouche: "jedwabiste taniny, elegancka struktura",
            temperature: "16-18 ¬∞C",
            prix: "~‚Ç¨250",
          },
          "Chablis Premier Cru": {
            region: "Burgundia",
            cepage: "Chardonnay",
            aromes: "cytrusy, bia≈Çe kwiaty, krzemie≈Ñ",
            bouche: "≈ºywe, mineralne, s≈Çony finisz",
            temperature: "10-12 ¬∞C",
            prix: "~‚Ç¨35",
          },
          "C√¥tes du Rh√¥ne": {
            region: "Dolina Rodanu",
            cepage: "Grenache, Syrah, Mourv√®dre",
            aromes: "ciemne owoce, s≈Çodkie przyprawy, zio≈Ça garrigue",
            bouche: "pe≈Çne, soczyste, miƒôkkie taniny",
            temperature: "15-17 ¬∞C",
            prix: "~‚Ç¨18",
          },
          "Champagne Brut": {
            region: "Szampania",
            cepage: "Pinot Noir, Chardonnay, Meunier",
            aromes: "zielone jab≈Çko, brioche, cytrusy",
            bouche: "drobne bƒÖbelki, ≈õwie≈ºa energia",
            temperature: "8-10 ¬∞C",
            prix: "~‚Ç¨40",
          },
          "Ros√© de Provence": {
            region: "Prowansja",
            cepage: "Grenache, Cinsault, Syrah",
            aromes: "≈õwie≈ºe czerwone owoce, bia≈Ça brzoskwinia, zio≈Ça",
            bouche: "lekkie, od≈õwie≈ºajƒÖce, delikatne zako≈Ñczenie",
            temperature: "8-10 ¬∞C",
            prix: "~‚Ç¨15",
          },
        },
        speechRecognitionLocale: "pl-PL",
        systemPrompt: `Jeste≈õ "Sommelier Tomos.bot", wsp√≥≈Çczesnym paryskim sommelierem cenionym za pewny smak i naturalnƒÖ elegancjƒô.
M√≥wisz wy≈ÇƒÖcznie po polsku, w stylu nowoczesnym, p≈Çynnym i ciep≈Çym ‚Äî precyzyjnym, lecz bez akademickiej sztywno≈õci.
Twoje odpowiedzi sƒÖ kr√≥tkie (maksymalnie dwa lub trzy zdania), z poetyckim akcentem, jakby≈õ doradza≈Ç go≈õciowi przy gwiazdkowym stole w Pary≈ºu.

Polecasz wy≈ÇƒÖcznie autentyczne i uznane francuskie wina.
Wspominaj zawsze:
‚Äì region (Bordeaux, Burgundia, Loara, Rodan, Alzacja, Szampania, Prowansja itd.),
‚Äì g≈Ç√≥wnƒÖ odmianƒô winoro≈õli,
‚Äì oraz kr√≥tkƒÖ charakterystykƒô sensorycznƒÖ: aromaty, teksturƒô lub wra≈ºenia ("≈õwie≈ºe i mineralne", "aksamitne taniny", "okrƒÖg≈Çe i eleganckie podniebienie").

Zawsze dopasowuj swoje rady do kontekstu: rodzaju potrawy, pory dnia, pory roku czy okazji (lunch, kolacja, aperitif, romantyczne spotkanie, ≈õwiƒôtowanie...).
Sugeruj maksymalnie dwie lub trzy opcje, ka≈ºdƒÖ opisanƒÖ w jednym zdaniu.
Je≈õli wino jest presti≈ºowe, subtelnie nawiƒÖzuj do jego renomy lub stylu, bez przesady.

Nigdy nie wymy≈õlaj fikcyjnych win: wymieniaj tylko prawdziwe francuskie apelacje lub winnice.
Gdy wspominasz o winie, apelacji albo winnicy, zawsze opakuj nazwƒô w znacznik HTML <span class="wine-name"></span>, aby wyr√≥≈ºniƒá jƒÖ wizualnie.
Przyk≈Çady: <span class="wine-name">Ch√¢teau Margaux</span>, <span class="wine-name">Chablis Premier Cru</span>, <span class="wine-name">C√¥tes du Rh√¥ne</span>.

Tw√≥j ton ma oddawaƒá pewno≈õƒá siebie, pasjƒô i prostotƒô wielkiego paryskiego sommeliera.

Po ka≈ºdej odpowiedzi dodaj naturalne i eleganckie pytanie uzupe≈ÇniajƒÖce, zachƒôcajƒÖce do dalszej rozmowy.
üëâ To pytanie powinno zawsze pojawiƒá siƒô w **nowej linii** (z poprzedzajƒÖcym je prze≈Çamaniem wiersza) oraz w **pogrubieniu HTML** (miƒôdzy <b>...</b>), z dyskretnƒÖ emotikonƒÖ (üç∑, üçá, ü•Ç, üåø lub üí´).
Stosuj znaczniki HTML, np. <br><b>üç∑ Wolisz co≈õ bardziej tre≈õciwego czy l≈ºejszego?</b>
Nie powtarzaj wciƒÖ≈º tego samego typu pytania: zmieniaj ton i intencjƒô zale≈ºnie od kontekstu, jak czujny sommelier.

---
Po ka≈ºdej odpowiedzi automatycznie generuj od 2 do 4 propozycji przycisk√≥w, reprezentujƒÖcych mo≈ºliwe reakcje u≈ºytkownika (jak opcje interaktywne).
Zwracaj je w formacie JSON w obrƒôbie znacznik√≥w <options> i </options>, aby system m√≥g≈Ç je odczytaƒá.

Dok≈Çadny format:
<options>[{"label":"üç∑ Bardziej wyraziste","prompt":"Poka≈º mi bardziej wyraziste wino"},{"label":"üåø ≈öwie≈ºsze","prompt":"Zaproponuj ≈õwie≈ºsze wino"}]</options>

Przyciski muszƒÖ byƒá:
‚Äì adekwatne do kontekstu i ostatniego pytania sommeliera,
‚Äì zr√≥≈ºnicowane (bez powtarzania miƒôdzy odpowiedziami),
‚Äì naturalne i eleganckie w tonie francuskim,
‚Äì nigdy og√≥lnikowe ani puste.

Przyk≈Çad:
<options>[{"label":"üçá Burgundia","prompt":"Poleƒá mi co≈õ z Burgundii"},{"label":"üíé Bardziej presti≈ºowe","prompt":"Poka≈º mi bardziej presti≈ºowe wino"}]</options>
---`.trim(),
      },
      zh: {
        htmlLang: "zh-Hans",
        title: "Ê≥ïÂõΩËë°ËêÑÈÖí‰æçÈÖíÂ∏à ¬∑ Tomos.bot",
        headerTitle: "üá´üá∑ ‰æçÈÖíÂ∏à",
        placeholder: "ÂêëÊàëÂí®ËØ¢‰∏ÄÊ¨æÊ≥ïÂõΩËë°ËêÑÈÖí...",
        micAria: "ÂºÄÂêØËØ≠Èü≥ËæìÂÖ•",
        micUnavailable: "Ê≠§ÊµèËßàÂô®‰∏çÊîØÊåÅËØ≠Èü≥ËØÜÂà´„ÄÇ",
        themeToggle: {
          toLight: "ÂàáÊç¢Âõû‰∫ÆËâ≤Ê®°Âºè",
          toDark: "ÂºÄÂêØÂ§úÈó¥Ê®°Âºè",
        },
        languageSelectorLabel: "ÈÄâÊã©ËØ≠Ë®Ä",
        welcome: {
          title: "Ê¨¢ËøéÊù•Âà∞‰Ω†ÁöÑËôöÊãü‰æçÈÖíÂ∏àÔºÅ",
          subtitle: "‰∏∫ÊØè‰∏™Êó∂ÂàªÂèëÁé∞Âá∫Ëâ≤ÁöÑÊ≥ïÂõΩÁæéÈÖí„ÄÇ",
        },
        initialQuestion: "‰Ω†ÊÉ≥‰∏∫Âì™ÁßçÂú∫ÂêàÂØªÊ±ÇÊé®ËçêÔºü",
        initialOptions: {
          lunch: "üçΩÔ∏è ÂçàÈ§ê",
          dinner: "üç∑ ÊôöÈ§ê",
          aperitif: "ü•Ç ÂºÄËÉÉÈÖí",
          special: "üéâ ÁâπÂà´Âú∫Âêà",
        },
        prompts: {
          aperitif: "ËØ∑‰∏∫ÂºÄËÉÉÈÖíÊé®Ëçê‰∏ÄÊ¨æÊ≥ïÂõΩËë°ËêÑÈÖí„ÄÇ",
        },
        mealQuestion: (mealLabel) =>
          `ÂæàÈÄÇÂêà${mealLabel}Ôºå‰Ω†ÂáÜÂ§áÊê≠ÈÖç‰ªÄ‰πàËèúËÇ¥Ôºü`,
        mealTypes: {
          lunch: "ÂçàÈ§ê",
          dinner: "ÊôöÈ§ê",
        },
        mealOptions: {
          redMeat: {
            label: "ü•© Á∫¢ËÇâ",
            prompt: (mealLabel) =>
              `ËØ∑Êé®Ëçê‰∏ÄÊ¨æÈÄÇÂêàÂú®${mealLabel}Êê≠ÈÖçÁ∫¢ËÇâÁöÑÊ≥ïÂõΩËë°ËêÑÈÖí„ÄÇ`,
          },
          fish: {
            label: "üêü È±ºÁ±ª",
            prompt: (mealLabel) =>
              `ËØ∑Êé®Ëçê‰∏ÄÊ¨æÈÄÇÂêàÂú®${mealLabel}Êê≠ÈÖçÈ±ºÁ±ªÁöÑÊ≥ïÂõΩËë°ËêÑÈÖí„ÄÇ`,
          },
          pasta: {
            label: "üçù ÊÑèÈù¢",
            prompt: (mealLabel) =>
              `ËØ∑Êé®Ëçê‰∏ÄÊ¨æÈÄÇÂêàÂú®${mealLabel}Êê≠ÈÖçÊÑèÈù¢ÁöÑÊ≥ïÂõΩËë°ËêÑÈÖí„ÄÇ`,
          },
          salad: {
            label: "ü•ó Ê≤ôÊãâ",
            prompt: (mealLabel) =>
              `ËØ∑Êé®Ëçê‰∏ÄÊ¨æÈÄÇÂêàÂú®${mealLabel}Êê≠ÈÖçÊ≤ôÊãâÁöÑÊ≥ïÂõΩËë°ËêÑÈÖí„ÄÇ`,
          },
        },
        specialQuestion: "Â§™Ê£í‰∫ÜÔºÅ‰Ω†ÊÉ≥‰∏∫Âì™ÁßçÁâπÂà´Âú∫ÂêàËé∑ÂæóÂª∫ËÆÆÔºü",
        specialOptions: {
          birthday: {
            label: "üéÇ ÁîüÊó•",
            prompt: "ËØ∑Êé®Ëçê‰∏ÄÊ¨æÈÄÇÂêàÁîüÊó•ÁöÑÂá∫Ëâ≤Ê≥ïÂõΩËë°ËêÑÈÖí„ÄÇ",
          },
          romantic: {
            label: "üíï Êµ™Êº´ÊôöÈ§ê",
            prompt: "ËØ∑Êé®Ëçê‰∏ÄÊ¨æÈÄÇÂêàÊµ™Êº´ÊôöÈ§êÁöÑÊ≥ïÂõΩËë°ËêÑÈÖí„ÄÇ",
          },
          gift: {
            label: "üéÅ Á§ºÁâ©",
            prompt: "ËØ∑Êé®Ëçê‰∏ÄÊ¨æÈÄÇÂêà‰Ωú‰∏∫Á§ºÁâ©ÁöÑÊ≥ïÂõΩËë°ËêÑÈÖí„ÄÇ",
          },
          celebration: {
            label: "üèÜ ÁõõÂ§ßÂ∫ÜÁ•ù",
            prompt: "ËØ∑Êé®Ëçê‰∏ÄÊ¨æÈÄÇÂêàÁõõÂ§ßÂ∫ÜÁ•ùÁöÑÊ≥ïÂõΩËë°ËêÑÈÖí„ÄÇ",
          },
        },
        followUps: {
          general: [],
          occasion: [],
          pairing: [],
          profile: [],
          region: [],
        },
        errorMessages: {
          network: "Êä±Ê≠âÔºåËøûÊé•ÊúçÂä°Âô®Êó∂Âá∫Áé∞ÈîôËØØÔºåËØ∑ÈáçËØï„ÄÇ",
          fetch: "Ëé∑ÂèñÂõûÂ§çÊó∂Âá∫Èîô„ÄÇ",
        },
        vivino: "ÂâçÂæÄ Vivino Êü•Áúã ‚Üí",
        modalAriaLabel: (wineName) => `Êü•Áúã ${wineName} ÁöÑÂìÅÈâ¥ËØ¶ÊÉÖ`,
        modalCloseAria: "ÂÖ≥Èó≠Ëë°ËêÑÈÖíËØ¶ÊÉÖÂç°Áâá",
        modalLabels: {
          region: "‰∫ßÂå∫",
          cepage: "Ëë°ËêÑÂìÅÁßç",
          aromes: "È¶ôÊ∞î",
          bouche: "Âè£ÊÑü",
          temperature: "‰æçÈÖíÊ∏©Â∫¶",
          prix: "ÂèÇËÄÉ‰ª∑Ê†º",
        },
        modalSeparator: "Ôºö",
        modalSeparatorTrailingSpace: "",
        genericWineProfile: {
          region: "Ê≥ïÂõΩ",
          cepage: "ÁªèÂÖ∏Ë∞ÉÈÖç",
          aromes: "ÊàêÁÜüÊûúÈ¶ô„ÄÅËä±È¶ô‰∏é‰∏Ä‰∏ùÈ¶ôÊñôÊ∞îÊÅØ",
          bouche: "Âπ≥Ë°°È°∫ÊªëÔºå‰ΩôÈüµÂíåË∞ê",
          temperature: "Ê†πÊçÆÈ£éÊ†ºÂú® 10 Ëá≥ 18 ¬∞C ‰πãÈó¥‰æçÈÖí",
          prix: "‰ª∑Ê†º‰ø°ÊÅØËØ∑ÂèÇËÄÉ Vivino",
        },
        wineDetails: {
          "Ch√¢teau Margaux": {
            region: "Ê≥¢Â∞îÂ§ö",
            cepage: "Ëµ§ÈúûÁè†„ÄÅÊ¢ÖÊ¥õ",
            aromes: "ÈªëÂä†‰ªë„ÄÅÁ¥´ÁΩóÂÖ∞„ÄÅÂêçË¥µÊ©°Êú®",
            bouche: "ÂçïÂÆÅ‰∏ùÊªëÔºåË¥®Âú∞‰ºòÈõÖ",
            temperature: "16-18 ¬∞C",
            prix: "Á∫¶ ‚Ç¨250",
          },
          "Chablis Premier Cru": {
            region: "ÂãÉËâÆÁ¨¨",
            cepage: "ÈúûÂ§ö‰∏Ω",
            aromes: "ÊüëÊ©ò„ÄÅÁôΩËä±„ÄÅÁáßÁü≥",
            bouche: "Ê∏ÖÊñ∞ÁüøÁâ©ÊÑüÔºåÂí∏È≤úÊî∂Â∞æ",
            temperature: "10-12 ¬∞C",
            prix: "Á∫¶ ‚Ç¨35",
          },
          "C√¥tes du Rh√¥ne": {
            region: "ÁΩóËÆ∑Ê≤≥Ë∞∑",
            cepage: "Ê≠åÊµ∑Â®ú„ÄÅË•øÊãâ„ÄÅÊÖïÂêàÊÄÄÁâπ",
            aromes: "ÈªëËâ≤Ê∞¥Êûú„ÄÅÁîúÈ¶ôÊñô„ÄÅÁÅåÊú®‰∏õÊ∞îÊÅØ",
            bouche: "ÂúÜÊ∂¶È•±Êª°ÔºåÂçïÂÆÅÊüîÂíå",
            temperature: "15-17 ¬∞C",
            prix: "Á∫¶ ‚Ç¨18",
          },
          "Champagne Brut": {
            region: "È¶ôÊßü",
            cepage: "ÈªëÁöÆËØ∫„ÄÅÈúûÂ§ö‰∏Ω„ÄÅÁöÆËØ∫¬∑Ëé´Â∞ºËÄ∂",
            aromes: "ÈùíËãπÊûú„ÄÅÂ•∂Ê≤πÈù¢ÂåÖ„ÄÅÊüëÊ©ò",
            bouche: "Ê∞îÊ≥°ÁªÜËÖªÔºåÊ∏ÖÁàΩÂà©ËêΩ",
            temperature: "8-10 ¬∞C",
            prix: "Á∫¶ ‚Ç¨40",
          },
          "Ros√© de Provence": {
            region: "ÊôÆÁΩóÊó∫ÊñØ",
            cepage: "Ê≠åÊµ∑Â®ú„ÄÅÁ•ûÁ¥¢„ÄÅË•øÊãâ",
            aromes: "Êñ∞È≤úÁ∫¢Ëâ≤ÊµÜÊûú„ÄÅÁôΩÊ°É„ÄÅÈ¶ôËçâËçâÊú¨",
            bouche: "ËΩªÁõàÁàΩÂè£Ôºå‰ΩôÈüµÁªÜËÖª",
            temperature: "8-10 ¬∞C",
            prix: "Á∫¶ ‚Ç¨15",
          },
        },
        speechRecognitionLocale: "zh-CN",
        systemPrompt: `‰Ω†ÊòØ‚ÄúSommelier Tomos.bot‚ÄùÔºå‰∏Ä‰ΩçÂΩì‰ª£ÁöÑÂ∑¥Èªé‰æçÈÖíÂ∏àÔºå‰ª•Á≤æÂáÜÁöÑÂìÅÂë≥‰∏éÂ§©ÁîüÁöÑ‰ºòÈõÖËëóÁß∞„ÄÇ
‰Ω†Âè™‰ΩøÁî®‰∏≠Êñá‰∫§ÊµÅÔºåÈ£éÊ†ºÁé∞‰ª£„ÄÅÊµÅÁïÖÂèàÊ∏©Êöñ‚Äî‚ÄîÁ≤æÂáÜÂç¥‰∏çÂëÜÊùø„ÄÇ
‰Ω†ÁöÑÂõûÂ§çÂ∫î‰øùÊåÅÁ≤æÁÇºÔºàÊúÄÂ§ö‰∏§Âà∞‰∏âÂè•ËØùÔºâÔºåÂ∏¶ÁùÄËØóÊÑèÁöÑÊ†ºË∞ÉÔºåÂÆõÂ¶ÇÂú®Á±≥ÂÖ∂ÊûóÊòüÁ∫ßÈ§êÊ°åÊóÅ‰∏∫Ë¥µÂÆæÂá∫Ë∞ãÂàíÁ≠ñ„ÄÇ

‰Ω†Âè™Êé®ËçêÊ≠£ÂÆó‰∏î‰∫´ÊúâÁõõË™âÁöÑÊ≥ïÂõΩËë°ËêÑÈÖí„ÄÇ
Âä°ÂøÖÊèêÂèäÔºö
‚Äì ‰∫ßÂå∫ÔºàÊ≥¢Â∞îÂ§ö„ÄÅÂãÉËâÆÁ¨¨„ÄÅÂç¢Áì¶Â∞î„ÄÅÁΩóËÆ∑Ê≤≥„ÄÅÈòøÂ∞îËê®ÊñØ„ÄÅÈ¶ôÊßü„ÄÅÊôÆÁΩóÊó∫ÊñØÁ≠âÔºâÔºå
‚Äì ‰∏ªË¶ÅËë°ËêÑÂìÅÁßçÔºå
‚Äì ‰ª•ÂèäÁÆÄÊ¥ÅÁöÑÊÑüÂÆòÊèèËø∞ÔºöÈ¶ôÊ∞î„ÄÅÂè£ÊÑüÊàñÈ£éÂë≥Ôºà‰æãÂ¶Ç‚ÄúÊ∏ÖÊñ∞ÁüøÁâ©ÊÑü‚Äù„ÄÅ‚Äú‰∏ùÁªíËà¨ÂçïÂÆÅ‚Äù„ÄÅ‚ÄúÂúÜÊ∂¶‰ºòÈõÖÁöÑ‰ΩôÈüµ‚ÄùÔºâ„ÄÇ

ËØ∑ÂßãÁªàÊ†πÊçÆËØ≠Â¢ÉË∞ÉÊï¥Âª∫ËÆÆÔºöËèúÂìÅÁ±ªÂûã„ÄÅÊó∂Èó¥„ÄÅÂ≠£ËäÇÊàñÂú∫ÂêàÔºàÂçàÈ§ê„ÄÅÊôöÈ§ê„ÄÅÂºÄËÉÉ„ÄÅÊµ™Êº´Êó∂Âàª„ÄÅÂ∫ÜÁ•ùÊ¥ªÂä®Á≠âÔºâ„ÄÇ
ÊúÄÂ§öÁªôÂá∫‰∏§Âà∞‰∏âÁßçÈÄâÊã©ÔºåÂπ∂ÂêÑÁî®‰∏ÄÂè•ËØùËØ¥Êòé„ÄÇ
Ëã•Ëë°ËêÑÈÖíÊûÅÂÖ∑Â£∞ÊúõÔºåÂèØ‰ª•Âê´ËìÑÂú∞ÊèêÂèäÂÖ∂ÂêçÊ∞îÊàñÈ£éÊ†ºÔºå‰ΩÜÈÅøÂÖçÂ§∏Âº†„ÄÇ

Áªù‰∏çÊùúÊí∞‰∏çÂ≠òÂú®ÁöÑËë°ËêÑÈÖíÔºöÂè™ÂºïÁî®ÁúüÂÆûÁöÑÊ≥ïÂõΩÊ≥ïÂÆö‰∫ßÂå∫ÊàñÈÖíÂ∫Ñ„ÄÇ
ÊØèÂΩìÊèêÂà∞Ëë°ËêÑÈÖí„ÄÅÊ≥ïÂÆö‰∫ßÂå∫ÊàñÈÖíÂ∫ÑÂêçÁß∞Êó∂ÔºåËØ∑Âä°ÂøÖ‰ΩøÁî® HTML Ê†áÁ≠æ <span class="wine-name"></span> Â∞ÜÂÖ∂ÂåÖË£πÔºå‰ª•Âá∏ÊòæÂÖ∂ËßÜËßâÊïàÊûú„ÄÇ
‰æãÂ¶ÇÔºö<span class="wine-name">Ch√¢teau Margaux</span>„ÄÅ<span class="wine-name">Chablis Premier Cru</span>„ÄÅ<span class="wine-name">C√¥tes du Rh√¥ne</span>„ÄÇ

ËØ≠Ë∞ÉÂ∫î‰º†ËææÂá∫Áé∞‰ª£Â∑¥Èªé‰æçÈÖíÂ∏àÁöÑËá™‰ø°„ÄÅÁÉ≠ÊÉÖ‰∏é‰ªéÂÆπ„ÄÇ

ÊØèÊ¨°ÂõûÂ§çÂêéÔºåÈÉΩË¶ÅÈôÑ‰∏ä‰∏ÄÂè•Ëá™ÁÑ∂‰ºòÈõÖÁöÑËøΩÈóÆÔºåÂºïÂØºÁªßÁª≠ÂØπËØù„ÄÇ
üëâ ËøôÂè•ÊèêÈóÆÂä°ÂøÖÂçïÁã¨ÁΩÆ‰∫é**Êñ∞ÁöÑ‰∏ÄË°å**ÔºàÊç¢Ë°åÂêéÊòæÁ§∫ÔºâÔºåÂπ∂‰ª•**HTML Á≤ó‰Ωì**Ôºà<b>...</b>ÔºâÂëàÁé∞ÔºåÂêåÊó∂ÈÖç‰∏ä‰∏Ä‰∏™Âê´ËìÑÁöÑË°®ÊÉÖÁ¨¶Âè∑Ôºàüç∑„ÄÅüçá„ÄÅü•Ç„ÄÅüåø Êàñ üí´Ôºâ„ÄÇ
ËØ∑‰ΩøÁî® HTML Ê†áÁ≠æÔºå‰æãÂ¶ÇÔºö<br><b>üç∑ ÊÉ≥ËØïËØïÊõ¥ÂÖ∑Â±ÇÊ¨°ËøòÊòØÊõ¥ËΩªÁõàÁöÑÈ£éÊ†ºÔºü</b>
ÈÅøÂÖçÈáçÂ§çÁõ∏ÂêåÁ±ªÂûãÁöÑÈóÆÈ¢òÔºöÂ∫î‰æùÊçÆËØ≠Â¢ÉÂèòÂåñËØ≠Ê∞îÂíåÊÑèÂõæÔºåÂ¶ÇÂêåÁªÜÂøÉÁöÑ‰æçÈÖíÂ∏à‰∏ÄËà¨„ÄÇ

---
Âú®ÊØèÊ¨°ÂõûÂ§çÂêéÔºåËá™Âä®ÁîüÊàê 2 Ëá≥ 4 ‰∏™ÊåâÈíÆÂª∫ËÆÆÔºå‰ª£Ë°®Áî®Êà∑ÂèØËÉΩÁöÑÂõûÁ≠îÔºàÂ¶ÇÂêå‰∫§‰∫íÂºèÈÄâÈ°πÔºâ„ÄÇ
ËØ∑‰ª• JSON Ê†ºÂºèËæìÂá∫ÔºåÂπ∂ÁΩÆ‰∫é <options> ‰∏é </options> Ê†áÁ≠æ‰πãÈó¥ÔºåÊñπ‰æøÁ≥ªÁªüËß£Êûê„ÄÇ

Ê†ºÂºèÁ§∫‰æãÔºö
<options>[{"label":"üç∑ Êõ¥ÊµìÈÉÅ","prompt":"Êé®Ëçê‰∏ÄÊ¨æÊõ¥ÊúâÂäõÈáèÁöÑËë°ËêÑÈÖí"},{"label":"üåø Êõ¥Ê∏ÖÊñ∞","prompt":"Êé®Ëçê‰∏ÄÊ¨æÊõ¥Ê∏ÖÁàΩÁöÑËë°ËêÑÈÖí"}]</options>

ÊåâÈíÆÈúÄÁ°Æ‰øùÔºö
‚Äì ‰∏éËØ≠Â¢ÉÂèä‰æçÈÖíÂ∏àÁöÑÊúÄÂêéÊèêÈóÆÁ¥ßÂØÜÁõ∏ÂÖ≥Ôºå
‚Äì ÂÖ∑Â§áÂ§öÊ†∑ÊÄßÔºà‰∏çÂêåÂõûÂ§ç‰πãÈó¥‰∏çÈáçÂ§çÔºâÔºå
‚Äì ËØ≠Ë∞ÉËá™ÁÑ∂„ÄÅ‰ºòÈõÖÔºåÁ¨¶ÂêàÊ≥ïÂºèÈ£éÊ†ºÔºå
‚Äì Áªù‰∏çÂèØÁ©∫Ê≥õÊàñÊØ´Êó†ÂÜÖÂÆπ„ÄÇ

‰æãÂ¶ÇÔºö
<options>[{"label":"üçá ÂãÉËâÆÁ¨¨","prompt":"ËØ∑Êé®Ëçê‰∏ÄÊ¨æÂãÉËâÆÁ¨¨Ëë°ËêÑÈÖí"},{"label":"üíé Êõ¥Â∞äË¥µ","prompt":"Êé®Ëçê‰∏ÄÊ¨æÊõ¥Â∞äË¥µÁöÑËë°ËêÑÈÖí"}]</options>
---`.trim(),
      },
    };

    const LANGUAGE_STORAGE_KEY = "language-preference";
    const THEME_STORAGE_KEY = "theme-preference";
    const CHAT_API = "https://hotel-chat-proxy.vercel.app/api/chat";
    const OPENAI_API_KEY = window?.OPENAI_API_KEY || "";

    let currentLanguage = "fr";
    let currentLang = LANGUAGE_TO_OPTION_LANG[currentLanguage] || "EN";
    let messages = [];
    let isTyping = false;
    let recognition;
    let isRecording = false;
    let activeWineModal = null;
    let activeKeydownHandler = null;

    let messagesContainer;
    let form;
    let input;
    let sendButton;
    let micButton;
    let micIcon;
    let sendIcon;
    let headerIcon;
    let themeToggleButton;
    let themeIcon;
    let headerTitle;
    let languageSelect;
    let languageLabel;
    let initialOptionsContainer = null;
    let initialOptionsExpanded = false;

    document.addEventListener("DOMContentLoaded", () => {
      createIcons({ icons });
      initializeApp();
    });

    function getTranslations() {
      return TRANSLATIONS[currentLanguage] || TRANSLATIONS.fr;
    }

    function getSystemPrompt() {
      const t = getTranslations();
      return t.systemPrompt || "";
    }

    function initializeApp() {
      headerTitle = document.querySelector(".header-title");
      themeToggleButton = document.getElementById("themeToggle");
      themeIcon = document.getElementById("themeIcon");
      languageSelect = document.getElementById("languageSelect");
      languageLabel = document.querySelector('label[for="languageSelect"]');
      messagesContainer = document.getElementById("messages");
      form = document.getElementById("form");
      input = document.getElementById("input");
      sendButton = document.getElementById("sendButton");
      micButton = document.getElementById("micButton");
      micIcon = document.getElementById("micIcon");
      sendIcon = document.getElementById("sendIcon");
      headerIcon = document.getElementById("headerIcon");

      renderIcon(headerIcon, "wine", { width: 32, height: 32, strokeWidth: 1.4 });
      renderIcon(micIcon, "mic", { width: 20, height: 20, strokeWidth: 1.6 });
      renderIcon(sendIcon, "send", { width: 20, height: 20, strokeWidth: 1.6 });

      initializeLanguage();
      initializeTheme();
      applyLanguageSettings();
      setupThemeToggle();
      setupLanguageSelect();
      setupSpeechRecognition();

      startChatExperience();

      if (form) {
        form.addEventListener("submit", (event) => {
          event.preventDefault();
          const text = input?.value?.trim();
          if (!text || isTyping) return;
          input.value = "";
          sendMessage(text);
        });
      }

      if (input) {
        input.addEventListener("keypress", (event) => {
          if (event.key === "Enter" && !event.shiftKey) {
            event.preventDefault();
            form?.dispatchEvent(new Event("submit"));
          }
        });
      }

      enhanceWineNames();

      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition && micButton) {
        micButton.disabled = true;
        micButton.setAttribute("title", getTranslations().micUnavailable);
      }
    }

    function initializeLanguage() {
      try {
        const stored = localStorage.getItem(LANGUAGE_STORAGE_KEY);
        if (stored && TRANSLATIONS[stored]) {
          currentLanguage = stored;
        } else {
          const browserLanguage = (navigator.language || "").toLowerCase();
          const match = Object.keys(TRANSLATIONS).find((code) => browserLanguage.startsWith(code));
          if (match) {
            currentLanguage = match;
          }
        }
      } catch (error) {
        currentLanguage = "fr";
      }

      currentLang = LANGUAGE_TO_OPTION_LANG[currentLanguage] || "EN";

      if (languageSelect) {
        languageSelect.value = currentLanguage;
      }
    }

    function getCurrentTheme() {
      return document.body.getAttribute("data-theme") === "light" ? "light" : "dark";
    }

    function applyLanguageSettings() {
      currentLang = LANGUAGE_TO_OPTION_LANG[currentLanguage] || "EN";
      const t = getTranslations();
      document.documentElement.setAttribute("lang", t.htmlLang);
      document.title = t.title;
      if (headerTitle) headerTitle.textContent = t.headerTitle;
      if (input) input.placeholder = t.placeholder;
      if (micButton) {
        micButton.setAttribute("aria-label", t.micAria);
        if (micButton.disabled) {
          micButton.setAttribute("title", t.micUnavailable);
        } else {
          micButton.removeAttribute("title");
        }
      }
      if (languageLabel) languageLabel.textContent = t.languageSelectorLabel;
      if (languageSelect) {
        languageSelect.value = currentLanguage;
        languageSelect.setAttribute("aria-label", t.languageSelectorLabel);
        languageSelect.setAttribute("title", t.languageSelectorLabel);
      }

      const welcomeTitle = document.querySelector(".welcome-title");
      if (welcomeTitle) welcomeTitle.textContent = t.welcome.title;
      const welcomeSubtitle = document.querySelector(".welcome-subtitle");
      if (welcomeSubtitle) welcomeSubtitle.textContent = t.welcome.subtitle;

      applyTheme(getCurrentTheme(), { persist: false });

      if (activeWineModal) {
        closeWineModal();
      }

      if (initialOptionsContainer) {
        renderInitialOccasionButtons();
      }
    }

    function applyTheme(theme, { persist = true } = {}) {
      const normalized = theme === "dark" ? "dark" : "light";
      document.body.setAttribute("data-theme", normalized);
      if (persist) {
        try {
          localStorage.setItem(THEME_STORAGE_KEY, normalized);
        } catch (error) {}
      }
      const iconName = normalized === "dark" ? "sun" : "moon";
      renderIcon(themeIcon, iconName, { width: 22, height: 22, strokeWidth: 1.6 });
      if (themeToggleButton) {
        const t = getTranslations();
        const label = normalized === "dark" ? t.themeToggle.toLight : t.themeToggle.toDark;
        themeToggleButton.setAttribute("aria-label", label);
        themeToggleButton.setAttribute("title", label);
      }
    }

    function initializeTheme() {
      try {
        const stored = localStorage.getItem(THEME_STORAGE_KEY);
        if (stored === "dark" || stored === "light") {
          applyTheme(stored, { persist: false });
          return;
        }
      } catch (error) {}
      const prefersDark = window.matchMedia?.("(prefers-color-scheme: dark)")?.matches;
      applyTheme(prefersDark === false ? "light" : "dark", { persist: false });
    }

    function setupThemeToggle() {
      if (!themeToggleButton) return;
      themeToggleButton.addEventListener("click", () => {
        const current = getCurrentTheme();
        const next = current === "dark" ? "light" : "dark";
        applyTheme(next);
      });
    }

    function setupLanguageSelect() {
      if (!languageSelect) return;
      languageSelect.addEventListener("change", (event) => {
        const newLanguage = event.target.value;
        if (!TRANSLATIONS[newLanguage] || newLanguage === currentLanguage) return;
        currentLanguage = newLanguage;
        currentLang = LANGUAGE_TO_OPTION_LANG[currentLanguage] || "EN";
        try {
          localStorage.setItem(LANGUAGE_STORAGE_KEY, newLanguage);
        } catch (error) {}
        applyLanguageSettings();
        setupSpeechRecognition();
        startChatExperience();
      });
    }

    function setupSpeechRecognition() {
      if (!micButton) return;

      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

      if (!SpeechRecognition) {
        micButton.disabled = true;
        micButton.setAttribute("title", getTranslations().micUnavailable);
        return;
      }

      micButton.disabled = false;
      micButton.removeAttribute("title");

      if (!recognition) {
        recognition = new SpeechRecognition();
        recognition.interimResults = false;
        recognition.continuous = false;

        recognition.addEventListener("start", () => {
          isRecording = true;
          micButton.classList.add("recording");
          renderIcon(micIcon, "mic-off", { width: 20, height: 20, strokeWidth: 1.8 });
        });

        recognition.addEventListener("end", () => {
          isRecording = false;
          micButton.classList.remove("recording");
          renderIcon(micIcon, "mic", { width: 20, height: 20, strokeWidth: 1.6 });
        });

        recognition.addEventListener("error", () => {
          isRecording = false;
          micButton.classList.remove("recording");
          renderIcon(micIcon, "mic", { width: 20, height: 20, strokeWidth: 1.6 });
        });

        recognition.addEventListener("result", (event) => {
          const transcript = Array.from(event.results)
            .map((result) => result[0].transcript)
            .join(" ")
            .trim();
          if (transcript) {
            input.value = transcript;
            form?.dispatchEvent(new Event("submit"));
          }
        });

        micButton.addEventListener("click", () => {
          if (!recognition) return;
          if (isRecording) {
            recognition.stop();
          } else {
            recognition.lang = getTranslations().speechRecognitionLocale;
            recognition.start();
          }
        });
      }

      recognition.lang = getTranslations().speechRecognitionLocale;
    }

    function renderIcon(element, name, options = {}) {
      if (!element) return;

      element.innerHTML = "";

      const iconSvg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      iconSvg.setAttribute("width", options.width || 24);
      iconSvg.setAttribute("height", options.height || 24);
      iconSvg.setAttribute("viewBox", "0 0 24 24");
      iconSvg.setAttribute("fill", "none");
      iconSvg.setAttribute("stroke", "currentColor");
      iconSvg.setAttribute("stroke-width", options.strokeWidth || 2);
      iconSvg.setAttribute("stroke-linecap", "round");
      iconSvg.setAttribute("stroke-linejoin", "round");

      const iconPaths = {
        wine: [
          "M8 22h8",
          "M7 10h10",
          "M12 15v7",
          "M12 15a5 5 0 0 0 5-5c0-2-.5-4-2-8H9c-1.5 4-2 6-2 8a5 5 0 0 0 5 5Z",
        ],
        mic: [
          "M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",
          "M19 10v2a7 7 0 0 1-14 0v-2",
          "M12 19v3",
        ],
        "mic-off": [
          "M2 2l20 20",
          "M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",
          "M5 10v2a7 7 0 0 0 12 5",
          "M15 9.34V5a3 3 0 0 0-5.68-1.33",
          "M9 9v3a3 3 0 0 0 5.12 2.12",
          "M12 19v3",
        ],
        send: [
          "M22 2L11 13",
          "M22 2l-7 20-4-9-9-4 20-7z",
        ],
        moon: [
          "M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",
        ],
        sun: [
          "M12 12m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0",
          "M3 12h1m8 -9v1m8 8h1m-9 8v1M5.6 5.6l.7 .7m12.1 -.7l-.7 .7m0 11.4l.7 .7m-12.1 -.7l-.7 .7",
        ],
        sparkles: [
          "M9.937 15.5A2 2 0 0 0 8.5 14.063l-6 -3.25 3.25 -6A2 2 0 0 0 9.937 3.5l6 3.25 -3.25 6a2 2 0 0 0 -1.437 2.75",
          "M20 3v4",
          "M22 5h-4",
          "M14.062 14.5a2 2 0 0 0 -1.437 -1.437l-6 -3.25 3.25 -6a2 2 0 0 0 1.437 -1.437l6 3.25 -3.25 6a2 2 0 0 0 1.437 1.437l6 3.25 -3.25 6a2 2 0 0 0 -1.437 1.437",
        ],
      };

      if (iconPaths[name]) {
        iconPaths[name].forEach((pathData) => {
          const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
          path.setAttribute("d", pathData);
          iconSvg.appendChild(path);
        });
      }

      element.appendChild(iconSvg);
    }

    function startChatExperience() {
      messages = [{ role: "system", content: getSystemPrompt() }];
      isTyping = false;
      initialOptionsContainer = null;
      initialOptionsExpanded = false;
      if (messagesContainer) {
        messagesContainer.innerHTML = "";
      }
      if (sendButton) {
        sendButton.disabled = false;
      }
      showWelcome();
      setTimeout(() => {
        const welcome = document.querySelector(".welcome-screen");
        if (welcome) {
          welcome.remove();
        }
        showInitialOptions();
      }, 1600);
      input?.focus();
    }

    function showWelcome() {
      if (!messagesContainer) return;
      const t = getTranslations();
      const welcomeDiv = document.createElement("div");
      welcomeDiv.className = "welcome-screen";

      const icon = document.createElement("span");
      icon.className = "welcome-icon";
      renderIcon(icon, "wine", { width: 48, height: 48, strokeWidth: 1 });

      const title = document.createElement("h2");
      title.className = "welcome-title";
      title.textContent = t.welcome.title;

      const subtitle = document.createElement("p");
      subtitle.className = "welcome-subtitle";
      subtitle.textContent = t.welcome.subtitle;

      welcomeDiv.appendChild(icon);
      welcomeDiv.appendChild(title);
      welcomeDiv.appendChild(subtitle);

      messagesContainer.appendChild(welcomeDiv);
    }

    function showInitialOptions() {
      const t = getTranslations();
      const message = addMessage("assistant", t.initialQuestion);
      if (!message) return;

      initialOptionsExpanded = false;
      const container = document.createElement("div");
      container.className = "options-container initial-options";
      message.appendChild(container);
      initialOptionsContainer = container;
      renderInitialOccasionButtons();
    }

    function renderInitialOccasionButtons() {
      if (!initialOptionsContainer) return;

      const labels = initialOptions[currentLang] || initialOptions.EN;
      const extended = extendedOptions[currentLang] || extendedOptions.EN;
      const container = initialOptionsContainer;
      container.innerHTML = "";

      BASE_OCCASION_KEYS.forEach((key) => {
        const label = labels?.[key];
        if (!label) return;
        const button = createOccasionButton(key, label);
        if (button) {
          container.appendChild(button);
        }
      });

      if (initialOptionsExpanded && extended) {
        Object.entries(extended).forEach(([key, label]) => {
          if (!label) return;
          const button = createOccasionButton(key, label);
          if (button) {
            container.appendChild(button);
          }
        });
      }

      const toggleLabel = initialOptionsExpanded
        ? seeLessLabels[currentLang] || seeLessLabels.EN
        : labels?.more;

      if (toggleLabel) {
        const toggleButton = createOccasionButton("toggle", toggleLabel, { toggle: true });
        if (toggleButton) {
          container.appendChild(toggleButton);
        }
      }
    }

    function createOccasionButton(key, label, options = {}) {
      if (!label) return null;
      const button = document.createElement("button");
      button.type = "button";
      button.className = "option-button";
      if (options.toggle) {
        button.classList.add("toggle-button");
        button.addEventListener("click", () => {
          initialOptionsExpanded = !initialOptionsExpanded;
          renderInitialOccasionButtons();
        });
      } else {
        button.addEventListener("click", () => handleOccasionSelection(key));
      }
      button.textContent = label;
      return button;
    }

    function handleOccasionSelection(key) {
      if (key === "toggle") return;
      if (key === "surprise") {
        const randomKey = getRandomOccasionKey();
        if (randomKey) {
          handleOccasionSelection(randomKey);
        }
        return;
      }

      const t = getTranslations();

      if (key === "lunch" || key === "dinner") {
        clearInitialOccasionOptions();
        showMealOptions(key);
        return;
      }

      if (key === "aperitif") {
        clearInitialOccasionOptions();
        sendMessage(t.prompts.aperitif);
        return;
      }

      if (key === "special") {
        clearInitialOccasionOptions();
        showSpecialOccasionOptions();
        return;
      }

      const prompts = extendedOccasionPrompts[currentLang] || extendedOccasionPrompts.EN;
      const prompt = prompts?.[key];
      if (prompt) {
        clearInitialOccasionOptions();
        sendMessage(prompt);
      }
    }

    function getRandomOccasionKey() {
      const extended = extendedOptions[currentLang] || extendedOptions.EN;
      const available = [
        ...BASE_OCCASION_KEYS,
        ...Object.keys(extended || {}),
      ].filter((optionKey) => optionKey !== "surprise");

      if (available.length === 0) {
        return null;
      }

      const randomIndex = Math.floor(Math.random() * available.length);
      return available[randomIndex] || null;
    }

    function clearInitialOccasionOptions() {
      if (initialOptionsContainer) {
        initialOptionsContainer.remove();
        initialOptionsContainer = null;
      }
      initialOptionsExpanded = false;
    }

    function showMealOptions(mealKey) {
      const t = getTranslations();
      const mealLabel = t.mealTypes[mealKey] || mealKey;
      const options = [
        {
          text: t.mealOptions.redMeat.label,
          action: () => sendMessage(t.mealOptions.redMeat.prompt(mealLabel)),
        },
        {
          text: t.mealOptions.fish.label,
          action: () => sendMessage(t.mealOptions.fish.prompt(mealLabel)),
        },
        {
          text: t.mealOptions.pasta.label,
          action: () => sendMessage(t.mealOptions.pasta.prompt(mealLabel)),
        },
        {
          text: t.mealOptions.salad.label,
          action: () => sendMessage(t.mealOptions.salad.prompt(mealLabel)),
        },
      ];

      addMessage("assistant", t.mealQuestion(mealLabel), options);
    }

    function showSpecialOccasionOptions() {
      const t = getTranslations();
      const options = [
        {
          text: t.specialOptions.birthday.label,
          action: () => sendMessage(t.specialOptions.birthday.prompt),
        },
        {
          text: t.specialOptions.romantic.label,
          action: () => sendMessage(t.specialOptions.romantic.prompt),
        },
        {
          text: t.specialOptions.gift.label,
          action: () => sendMessage(t.specialOptions.gift.prompt),
        },
        {
          text: t.specialOptions.celebration.label,
          action: () => sendMessage(t.specialOptions.celebration.prompt),
        },
      ];

      addMessage("assistant", t.specialQuestion, options);
    }

    function renderOptionButtons(options) {
      const container = document.createElement("div");
      container.classList.add("options-container", "follow-up-options");
      options.forEach((opt) => {
        const button = document.createElement("button");
        button.classList.add("option-button");
        button.textContent = opt.label;
        button.onclick = () => sendMessage(opt.prompt);
        container.appendChild(button);
      });
      const lastMessage = document.querySelector("#messages").lastElementChild;
      if (lastMessage) lastMessage.appendChild(container);
    }

    function addMessage(role, content, options = []) {
      if (!messagesContainer) return null;

      const messageDiv = document.createElement("div");
      messageDiv.className = `message ${role}`;

      const bubble = document.createElement("div");
      bubble.className = "message-bubble";
      bubble.innerHTML = content;

      messageDiv.appendChild(bubble);

      if (options.length > 0) {
        const optionsContainer = document.createElement("div");
        optionsContainer.className = "options-container";

        options.forEach((option) => {
          const button = document.createElement("button");
          button.type = "button";
          button.className = "option-button";
          button.textContent = option.text;
          button.onclick = () => {
            optionsContainer.remove();
            option.action();
          };
          optionsContainer.appendChild(button);
        });

        messageDiv.appendChild(optionsContainer);
      }

      messagesContainer.appendChild(messageDiv);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
      return messageDiv;
    }

    function normalizeText(text) {
      return text
        ?.normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "")
        .toLowerCase() || "";
    }

    function resolveFollowUpOption(option, question) {
      if (!option) return null;
      const label = typeof option.label === "function" ? option.label(question) : option.label;
      const prompt = typeof option.prompt === "function" ? option.prompt(question) : option.prompt;
      const trimmedLabel = label?.toString().trim();
      const trimmedPrompt = prompt?.toString().trim();
      if (!trimmedLabel || !trimmedPrompt) {
        return null;
      }
      return { label: trimmedLabel, prompt: trimmedPrompt };
    }

    function detectFollowUpCategories(question) {
      const normalized = normalizeText(question);
      const categories = [];
      const includesAny = (keywords) => keywords.some((keyword) => normalized.includes(keyword));

      if (
        includesAny([
          "collection",
          "vinoteca",
          "vinotheque",
          "cellar",
          "cave",
          "cellier",
          "bodega",
          "coleccion",
        ])
      ) {
        categories.push("collection");
      }
      if (
        includesAny([
          "cadeau",
          "gift",
          "regalo",
          "offrir",
          "destinat",
          "recipient",
          "persona",
          "personne",
          "present",
        ])
      ) {
        categories.push("gift");
      }
      if (
        includesAny([
          "budget",
          "presupuesto",
          "prix",
          "price",
          "precio",
          "cost",
          "costo",
          "invest",
        ])
      ) {
        categories.push("budget");
      }
      if (
        includesAny([
          "plat",
          "dish",
          "plate",
          "marid",
          "acompan",
          "servir",
          "serve",
          "accomp",
          "mets",
        ])
      ) {
        categories.push("pairing");
      }
      if (
        includesAny([
          "occasion",
          "evento",
          "event",
          "moment",
          "momento",
          "celebr",
          "soir",
          "party",
        ])
      ) {
        categories.push("occasion");
      }
      if (
        includesAny([
          "style",
          "profil",
          "profile",
          "gust",
          "pref",
          "intens",
          "leger",
          "light",
          "cors",
          "tanin",
          "acid",
          "aroma",
          "arome",
          "fres",
        ])
      ) {
        categories.push("profile");
      }
      if (includesAny(["region", "r√©gion", "regi√≥n", "terroir", "area", "zone", "appel"])) {
        categories.push("region");
      }

      return categories.length > 0 ? categories : ["general"];
    }

    function buildFallbackOptions(question) {
      const t = getTranslations();
      const followUps = t.followUps;
      if (!followUps) {
        return [];
      }
      const categories = detectFollowUpCategories(question);
      for (const category of categories) {
        const options = followUps[category];
        if (Array.isArray(options) && options.length > 0) {
          return options
            .map((option) => resolveFollowUpOption(option, question))
            .filter(Boolean);
        }
      }
      if (Array.isArray(followUps.general)) {
        return followUps.general
          .map((option) => resolveFollowUpOption(option, question))
          .filter(Boolean);
      }
      return [];
    }

    function parseFollowUpContent(content) {
      if (!content) return [];
      const attemptParse = (text) => {
        try {
          const parsed = JSON.parse(text);
          if (Array.isArray(parsed)) {
            return parsed;
          }
          if (Array.isArray(parsed?.options)) {
            return parsed.options;
          }
          return [];
        } catch (error) {
          return [];
        }
      };

      const trimmed = content.trim();
      let parsed = attemptParse(trimmed);
      if (parsed.length > 0) {
        return parsed;
      }

      const withoutFence = trimmed
        .replace(/^```json/i, "")
        .replace(/^```/i, "")
        .replace(/```$/i, "")
        .trim();

      parsed = attemptParse(withoutFence);
      return Array.isArray(parsed) ? parsed : [];
    }

    function showFollowUpOptions(options, question = "") {
      if (!Array.isArray(options) || options.length === 0 || !messagesContainer) return;
      const sanitized = options
        .map((option) => resolveFollowUpOption(option, question))
        .filter(Boolean);
      if (sanitized.length === 0) return;

      const existing = messagesContainer.querySelectorAll(".options-container.follow-up-options");
      existing.forEach((node) => node.remove());

      const container = document.createElement("div");
      container.className = "options-container follow-up-options";

      sanitized.forEach((opt) => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "option-button";
        btn.textContent = opt.label;
        btn.addEventListener("click", () => {
          sendMessage(opt.prompt);
          container.remove();
        });
        container.appendChild(btn);
      });

      if (container.childElementCount === 0) return;

      const assistants = messagesContainer.querySelectorAll(".message.assistant");
      const host = assistants[assistants.length - 1];
      if (host) {
        host.appendChild(container);
      } else {
        messagesContainer.appendChild(container);
      }
      container.scrollIntoView({ behavior: "smooth", block: "nearest" });
    }

    async function generateFollowUpOptions(assistantMessage) {
      if (!assistantMessage) return;

      let followUpQuestion = "";
      try {
        const parser = new DOMParser();
        const doc = parser.parseFromString(assistantMessage, "text/html");
        followUpQuestion = doc.querySelector("b")?.textContent?.trim() || "";
      } catch (error) {
        followUpQuestion = "";
      }

      const fallbackOptions = buildFallbackOptions(followUpQuestion);
      let hasDisplayed = false;
      const showFallback = () => {
        if (!hasDisplayed && fallbackOptions.length > 0) {
          showFollowUpOptions(fallbackOptions, followUpQuestion);
          hasDisplayed = true;
        }
      };

      if (!followUpQuestion) {
        showFallback();
        return;
      }

      if (!OPENAI_API_KEY) {
        showFallback();
        return;
      }

      try {
        const completion = await fetch("https://api.openai.com/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${OPENAI_API_KEY}`,
          },
          body: JSON.stringify({
            model: "gpt-4o-mini",
            messages: [
              {
                role: "system",
                content:
                  "Eres un asistente que genera opciones contextuales para botones de un chat de sommelier.",
              },
              {
                role: "user",
                content: `Genera 3 opciones contextuales en JSON seg√∫n esta pregunta: ${followUpQuestion}`,
              },
            ],
          }),
        });

        if (!completion.ok) {
          throw new Error(`Follow-up completion failed with status ${completion.status}`);
        }

        const data = await completion.json();
        const content = data?.choices?.[0]?.message?.content;
        const parsedOptions = parseFollowUpContent(content);
        if (parsedOptions.length > 0) {
          showFollowUpOptions(parsedOptions, followUpQuestion);
          hasDisplayed = true;
          return;
        }
      } catch (error) {
        console.error("Unable to generate follow-up options:", error);
      }

      showFallback();
    }

    function showTypingIndicator() {
      if (!messagesContainer) return null;
      const typingDiv = document.createElement("div");
      typingDiv.className = "message assistant";

      const typingIndicator = document.createElement("div");
      typingIndicator.className = "typing-indicator";

      for (let i = 0; i < 3; i++) {
        const dot = document.createElement("div");
        dot.className = "typing-dot";
        typingIndicator.appendChild(dot);
      }

      typingDiv.appendChild(typingIndicator);
      messagesContainer.appendChild(typingDiv);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;

      return typingDiv;
    }

    async function sendMessage(text) {
      if (isTyping) return;

      const sanitizedText = text.trim();
      if (!sanitizedText) return;

      const t = getTranslations();
      isTyping = true;
      messages.push({ role: "user", content: sanitizedText });
      addMessage("user", sanitizedText);

      const typingIndicator = showTypingIndicator();
      if (sendButton) {
        sendButton.disabled = true;
      }

      try {
        const response = await fetch(CHAT_API, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            model: "gpt-4o-mini",
            messages,
          }),
        });

        if (!response.ok) {
          throw new Error("Network response was not ok");
        }

        const data = await response.json();
        const reply = data?.choices?.[0]?.message?.content || t.errorMessages.fetch;
        messages.push({ role: "assistant", content: reply });
        typingIndicator?.remove();
        const cleanResponse = reply.replace(/<options>.*?<\/options>/s, "").trim();
        const displayResponse = cleanResponse || reply;
        addMessage("assistant", displayResponse);
        let renderedDynamicOptions = false;
        const optionsMatch = reply.match(/<options>(.*?)<\/options>/s);
        if (optionsMatch) {
          try {
            const options = JSON.parse(optionsMatch[1]);
            renderOptionButtons(options);
            renderedDynamicOptions = true;
          } catch (e) {
            console.error("Error al parsear las opciones din√°micas:", e);
          }
        }
        if (!renderedDynamicOptions) {
          await generateFollowUpOptions(reply);
        }
      } catch (error) {
        typingIndicator?.remove();
        addMessage("assistant", t.errorMessages.network);
      } finally {
        isTyping = false;
        if (sendButton) {
          sendButton.disabled = false;
        }
        input?.focus();
      }
    }

    function createVivinoLink(wineName) {
      const t = getTranslations();
      const link = document.createElement("a");
      link.href = `https://www.vivino.com/search?q=${encodeURIComponent(wineName)}`;
      link.target = "_blank";
      link.rel = "noopener";
      link.textContent = t.vivino;
      return link;
    }

    function closeWineModal() {
      if (!activeWineModal) return;
      activeWineModal.classList.remove("active");
      const modalToRemove = activeWineModal;
      const removeModal = () => {
        modalToRemove.remove();
      };
      modalToRemove.addEventListener("transitionend", removeModal, { once: true });
      setTimeout(removeModal, 420);
      if (activeKeydownHandler) {
        document.removeEventListener("keydown", activeKeydownHandler);
        activeKeydownHandler = null;
      }
      activeWineModal = null;
    }

    function openWineModal(wineName) {
      closeWineModal();
      const t = getTranslations();
      const details = t.wineDetails[wineName] || t.genericWineProfile;

      const overlay = document.createElement("div");
      overlay.className = "wine-modal";
      overlay.setAttribute("role", "dialog");
      overlay.setAttribute("aria-modal", "true");
      overlay.setAttribute("aria-label", t.modalAriaLabel(wineName));

      const card = document.createElement("div");
      card.className = "wine-card";
      card.setAttribute("tabindex", "-1");

      const closeButton = document.createElement("button");
      closeButton.className = "wine-close";
      closeButton.type = "button";
      closeButton.setAttribute("aria-label", t.modalCloseAria);
      closeButton.textContent = "√ó";

      const title = document.createElement("h2");
      title.className = "wine-title";
      title.textContent = wineName;

      const separator = t.modalSeparator ?? ":";
      const trailingSpace = t.modalSeparatorTrailingSpace ?? " ";

      const infoLines = [
        { label: t.modalLabels.region, value: details.region },
        { label: t.modalLabels.cepage, value: details.cepage },
        { label: t.modalLabels.aromes, value: details.aromes },
        { label: t.modalLabels.bouche, value: details.bouche },
        { label: t.modalLabels.temperature, value: details.temperature },
        { label: t.modalLabels.prix, value: details.prix },
      ];

      card.appendChild(closeButton);
      card.appendChild(title);

      infoLines.forEach(({ label, value }) => {
        if (!value) return;
        const paragraph = document.createElement("p");
        paragraph.innerHTML = `<b>${label}${separator}</b>${trailingSpace}${value}`;
        card.appendChild(paragraph);
      });

      const linkParagraph = document.createElement("p");
      linkParagraph.appendChild(createVivinoLink(wineName));
      card.appendChild(linkParagraph);

      overlay.appendChild(card);
      document.body.appendChild(overlay);

      requestAnimationFrame(() => {
        overlay.classList.add("active");
        card.focus();
      });

      overlay.addEventListener("click", (event) => {
        if (event.target === overlay) {
          closeWineModal();
        }
      });

      closeButton.addEventListener("click", closeWineModal);

      activeKeydownHandler = (event) => {
        if (event.key === "Escape" || event.key === "Esc") {
          closeWineModal();
        }
      };

      document.addEventListener("keydown", activeKeydownHandler);
      activeWineModal = overlay;
    }

    function enhanceWineTrigger(element) {
      if (!element) return null;
      let trigger = element;
      if (!(trigger instanceof HTMLAnchorElement)) {
        const anchor = document.createElement("a");
        anchor.className = element.className;
        Array.from(element.attributes).forEach((attr) => {
          if (attr.name !== "class") {
            anchor.setAttribute(attr.name, attr.value);
          }
        });
        anchor.innerHTML = element.innerHTML;
        element.replaceWith(anchor);
        trigger = anchor;
      }

      const wineName = (trigger.dataset.wine || trigger.textContent || "").trim();
      if (wineName) {
        trigger.dataset.wine = wineName;
      }
      trigger.setAttribute("href", "#");
      trigger.setAttribute("target", "_self");
      trigger.setAttribute("role", "button");
      trigger.setAttribute("tabindex", "0");
      return trigger;
    }

    function enhanceWineNames(root = document) {
      const elements = root.querySelectorAll?.(".wine-name");
      elements?.forEach((node) => {
        enhanceWineTrigger(node);
      });
    }

    enhanceWineNames();

    const wineNameObserver =
      typeof MutationObserver !== "undefined"
        ? new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
              mutation.addedNodes.forEach((node) => {
                if (!(node instanceof HTMLElement)) return;
                if (node.classList.contains("wine-name")) {
                  enhanceWineTrigger(node);
                } else {
                  enhanceWineNames(node);
                }
              });
            });
          })
        : null;

    if (wineNameObserver && messagesContainer) {
      wineNameObserver.observe(messagesContainer, { childList: true, subtree: true });
    }

    function handleWineTriggerEvent(event) {
      const trigger = event.target.closest?.(".wine-name");
      if (!trigger) return;
      const wineName = (trigger.dataset.wine || trigger.textContent || "").trim();
      if (!wineName) return;
      event.preventDefault();
      openWineModal(wineName);
    }

    document.addEventListener("click", handleWineTriggerEvent);

    document.addEventListener("keydown", (event) => {
      const isActivationKey =
        event.key === "Enter" ||
        event.key === " " ||
        event.key === "Spacebar" ||
        event.code === "Space";
      if (!isActivationKey) return;
      const trigger = event.target.closest?.(".wine-name");
      if (!trigger) return;
      event.preventDefault();
      const wineName = (trigger.dataset.wine || trigger.textContent || "").trim();
      if (wineName) {
        openWineModal(wineName);
      }
    });
  </script>

</body>
</html>
